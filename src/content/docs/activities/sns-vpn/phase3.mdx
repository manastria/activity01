---
title: "Phase 3 - Configuration du serveur VPN SSL"
description: "Configuration complÃ¨te du serveur VPN SSL sur le Stormshield EVA1 pour permettre l'accÃ¨s distant sÃ©curisÃ©"
---

# Phase 3 : Configuration du serveur VPN SSL

## Informations

- **DurÃ©e estimÃ©e** : 2h00
- **PrÃ©requis** : Phases 1 et 2 terminÃ©es et validÃ©es
- **RÃ´le principal** : Ã‰tudiant Y (Serveur VPN)

---

## Objectifs de cette phase

- âœ… Comprendre le fonctionnement d'un VPN SSL
- âœ… Activer le service VPN SSL sur le Stormshield
- âœ… Configurer les certificats pour le VPN
- âœ… DÃ©finir les rÃ©seaux accessibles via le VPN
- âœ… Configurer le pool d'adresses IP pour les clients VPN
- âœ… Associer les utilisateurs/groupes autorisÃ©s
- âœ… Tester la configuration avant dÃ©ploiement

---

## Contexte : Comprendre le VPN SSL

### Qu'est-ce qu'un VPN SSL ?

Un **VPN SSL** (Virtual Private Network - Secure Sockets Layer) est une technologie qui permet :

- ğŸ” **Chiffrement** : Toutes les donnÃ©es transitent dans un tunnel sÃ©curisÃ©
- ğŸŒ **AccÃ¨s distant** : Se connecter au rÃ©seau d'entreprise depuis n'importe oÃ¹
- ğŸ”‘ **Authentification** : VÃ©rifier l'identitÃ© de l'utilisateur avant l'accÃ¨s
- ğŸ›¡ï¸ **SÃ©curitÃ©** : ProtÃ©ger les communications sur Internet

### DiffÃ©rence VPN SSL vs VPN IPsec

| CritÃ¨re              | VPN SSL                            | VPN IPsec                       |
| -------------------- | ---------------------------------- | ------------------------------- |
| **Usage**            | AccÃ¨s utilisateur distant (nomade) | Interconnexion de sites         |
| **Client**           | LÃ©ger (navigateur ou petit client) | Client lourd souvent requis     |
| **Port**             | 443 (HTTPS) - passe les firewalls  | 500/4500 (souvent bloquÃ©)       |
| **Authentification** | Login/mot de passe + certificat    | ClÃ©s prÃ©-partagÃ©es, certificats |
| **GranularitÃ©**      | Par utilisateur                    | Par site/rÃ©seau                 |

Pour notre cas (tÃ©lÃ©travail, agence distante), le **VPN SSL est le plus adaptÃ©**.

### Architecture du VPN SSL

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    INTERNET (LABO)                     â”‚
â”‚                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Client VPN   â”‚                    â”‚   SNS Y      â”‚  â”‚
â”‚  â”‚ 172.25.X.10  â”‚â”€â”€â”€â”€â”€ Tunnel â”€â”€â”€â”€â”€â”€â–¶â”‚ 172.25.Y.254 â”‚  â”‚
â”‚  â”‚              â”‚      SSL/TLS       â”‚ (port 443)   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                              â”‚         â”‚
â”‚                                              â”‚         â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                    â”‚ Tunnel VPN Ã©tabli                 â”‚
â”‚                    â–¼                                   â”‚
â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚            â”‚  Pool VPN     â”‚                           â”‚
â”‚            â”‚  10.Y.100.0/26â”‚                           â”‚
â”‚            â”‚  Client â†’ IP  â”‚                           â”‚
â”‚            â”‚  10.Y.100.5   â”‚                           â”‚
â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚                    â”‚                                   â”‚
â”‚                    â”‚ AccÃ¨s au rÃ©seau interne           â”‚
â”‚                    â–¼                                   â”‚
â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚            â”‚ RÃ©seau interneâ”‚                           â”‚
â”‚            â”‚ 10.Y.1.0/24   â”‚                           â”‚
â”‚            â”‚               â”‚                           â”‚
â”‚            â”‚ Serveur Debianâ”‚                           â”‚
â”‚            â”‚ 10.Y.1.20     â”‚                           â”‚
â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Fonctionnement :**
1. Le client se connecte au serveur VPN (172.25.Y.254:443)
2. Authentification avec login/mot de passe (LDAP)
3. Tunnel SSL/TLS chiffrÃ© Ã©tabli
4. Le client obtient une IP virtuelle (10.Y.100.5)
5. Le client peut accÃ©der au rÃ©seau interne (10.Y.1.0/24)

---

## Ã‰tape 3.1 : Activation du module VPN SSL

:::caution[RÃ´le spÃ©cifique]
**Cette phase est rÃ©alisÃ©e par l'Ã‰tudiant Y** (Serveur VPN).
L'Ã‰tudiant X observe et prend des notes pour comprendre la configuration.
:::

### ğŸ”§ TÃ¢che : Activer le service VPN SSL

**1. Se connecter Ã  l'interface web du SNS**

```
URL : https://172.25.Y.254/admin
Login : admin
Mot de passe : admin
```

**2. AccÃ©der Ã  la configuration VPN**

Menu de gauche :
```
Configuration â†’ VPN â†’ VPN SSL
```

**3. Activer le VPN SSL**

Onglet **GÃ©nÃ©ral** :

- **Activer le VPN SSL** : âœ… Cocher
- **Nom du service** : `VPN-TechServices`
- **Description** : `VPN SSL pour accÃ¨s distant sÃ©curisÃ©`

**4. Configuration du serveur**

**Interface d'Ã©coute :**
- **Interface** : SÃ©lectionner `out` (172.25.Y.254)
- **Port d'Ã©coute** : `443` (HTTPS standard)
  - âœ… Avantage : passe par la plupart des firewalls
  - Alternative possible : `1194` (port OpenVPN standard)

**Protocole :**
- **Protocole** : `SSL/TLS` (sÃ©lectionnÃ© par dÃ©faut)

**5. Appliquer**

Cliquer sur `Appliquer`.

:::tip[Port 443]
Le port 443 est le port HTTPS standard. En l'utilisant pour le VPN :
- âœ… Compatible avec la plupart des rÃ©seaux publics (hÃ´tels, cafÃ©s)
- âœ… Rarement bloquÃ© par les firewalls
- âš ï¸ Attention : si vous hÃ©bergez aussi un serveur web sur le mÃªme port, il faut utiliser le SNI (Server Name Indication)
:::

:::tip[Validation Ã‰tape 3.1]
- âœ… Message de confirmation : "VPN SSL activÃ©"
- âœ… Ã‰tat du service : "DÃ©marrÃ©" ou "Running"
- âœ… Capture d'Ã©cran : Page de configuration VPN SSL avec service activÃ©
:::

---

## Ã‰tape 3.2 : Configuration des certificats SSL

### ğŸ¯ Objectif
Configurer les certificats pour sÃ©curiser la connexion VPN.

### Contexte : Pourquoi des certificats ?

Le VPN SSL utilise des **certificats SSL/TLS** pour :
- Chiffrer les communications
- Authentifier le serveur (prouver son identitÃ©)
- Ã‰viter les attaques de type "Man-in-the-Middle"

### ğŸ”§ TÃ¢che : Utiliser le certificat auto-signÃ© par dÃ©faut

**1. AccÃ©der Ã  la gestion des certificats**

```
Configuration â†’ SystÃ¨me â†’ Gestion des certificats â†’ AutoritÃ© de certification
```

**2. VÃ©rifier l'autoritÃ© de certification (CA) interne**

Le Stormshield crÃ©e automatiquement une **CA interne** lors de l'initialisation :
- **Nom** : `Stormshield CA`
- **Utilisation** : Signer des certificats pour les services (VPN, web, etc.)

**3. VÃ©rifier le certificat du serveur**

```
Configuration â†’ SystÃ¨me â†’ Gestion des certificats â†’ Certificats
```

Vous devriez voir un certificat nommÃ© :
- **Nom** : `Firewall` ou `SSL-VPN-Server`
- **Ã‰metteur** : `Stormshield CA`
- **Utilisation** : `Serveur VPN SSL`
- **ValiditÃ©** : Plusieurs annÃ©es

:::tip[Certificat auto-signÃ©]
Pour cette activitÃ©, nous utilisons le **certificat auto-signÃ© par dÃ©faut** du SNS.

**En production**, on utiliserait :
- Un certificat signÃ© par une autoritÃ© reconnue (Let's Encrypt, DigiCert, etc.)
- Pour Ã©viter les alertes de sÃ©curitÃ© dans les navigateurs

**Pour l'activitÃ©** :
- âœ… Le certificat auto-signÃ© suffit
- âš ï¸ Le client devra accepter l'avertissement de sÃ©curitÃ©
:::

**4. Associer le certificat au VPN SSL**

```
Configuration â†’ VPN â†’ VPN SSL â†’ Onglet "Certificats"
```

- **Certificat serveur** : SÃ©lectionner le certificat par dÃ©faut
  - Si liste dÃ©roulante : choisir `Firewall` ou `SSL-VPN-Server`
  - Si dÃ©jÃ  sÃ©lectionnÃ© : laisser tel quel

**5. Appliquer**

:::tip[Validation Ã‰tape 3.2]
- âœ… Un certificat est associÃ© au service VPN SSL
- âœ… Le certificat est valide (date de validitÃ© OK)
- âœ… Capture d'Ã©cran : Page des certificats montrant le certificat VPN
:::

---

## Ã‰tape 3.3 : Configuration du pool d'adresses IP

### ğŸ¯ Objectif
DÃ©finir une plage d'adresses IP qui seront attribuÃ©es aux clients VPN connectÃ©s.

### Contexte : Le pool d'adresses VPN

Quand un client se connecte au VPN :
1. Il s'authentifie
2. Le serveur VPN lui attribue une **IP virtuelle** du pool
3. Cette IP permet au client d'accÃ©der au rÃ©seau interne comme s'il Ã©tait physiquement sur place

**Notre plan d'adressage :**
- RÃ©seau interne : `10.Y.1.0/24`
- Pool VPN : `10.Y.100.0/26` (64 adresses possibles)

### ğŸ”§ TÃ¢che : CrÃ©er le pool d'adresses

**1. AccÃ©der Ã  la configuration des pools**

```
Configuration â†’ VPN â†’ VPN SSL â†’ Onglet "Pools d'adresses"
```

**2. CrÃ©er un nouveau pool**

Cliquer sur `Ajouter` :

**ParamÃ¨tres du pool :**
- **Nom** : `Pool-VPN-Clients`
- **Description** : `Adresses IP pour les clients VPN SSL`
- **Type** : `Plage d'adresses` (range)

**Plage d'adresses :**
- **PremiÃ¨re adresse** : `10.Y.100.1` (remplacer Y par votre numÃ©ro)
- **DerniÃ¨re adresse** : `10.Y.100.62`
- **Masque rÃ©seau** : `255.255.255.192` (soit /26)

:::tip[Calcul du /26]
Un rÃ©seau en /26 contient 64 adresses :
- Adresse rÃ©seau : 10.Y.100.0 (non utilisable)
- PremiÃ¨re adresse hÃ´te : 10.Y.100.1
- DerniÃ¨re adresse hÃ´te : 10.Y.100.62
- Adresse broadcast : 10.Y.100.63 (non utilisable)
- Total utilisable : 62 adresses pour les clients VPN
:::

**Configuration avancÃ©e du pool :**
- **Passerelle** : `10.Y.1.254` (l'interface IN du SNS)
- **Serveurs DNS** :
  - DNS primaire : `172.25.254.15` (DNS du LABO)
  - DNS secondaire : `8.8.8.8` (optionnel)

**3. CrÃ©er le pool**

Cliquer sur `CrÃ©er`.

:::tip[Validation Ã‰tape 3.3]
- âœ… Le pool `Pool-VPN-Clients` apparaÃ®t dans la liste
- âœ… Plage : 10.Y.100.1 Ã  10.Y.100.62 (62 adresses)
- âœ… Capture d'Ã©cran : Configuration du pool d'adresses
:::

---

## Ã‰tape 3.4 : Configuration des rÃ©seaux accessibles

### ğŸ¯ Objectif
DÃ©finir quels rÃ©seaux les clients VPN pourront atteindre une fois connectÃ©s.

### ğŸ”§ TÃ¢che : CrÃ©er une politique d'accÃ¨s rÃ©seau

**1. AccÃ©der Ã  la configuration des rÃ©seaux**

```
Configuration â†’ VPN â†’ VPN SSL â†’ Onglet "RÃ©seaux distants"
```

**2. Ajouter un rÃ©seau distant**

Cliquer sur `Ajouter` :

**ParamÃ¨tres :**
- **Nom** : `Reseau-Interne-Entreprise`
- **Description** : `RÃ©seau interne accessible via VPN`
- **Type** : `RÃ©seau IPv4`

**RÃ©seau :**
- **Adresse rÃ©seau** : `10.Y.1.0` (remplacer Y)
- **Masque** : `255.255.255.0` (soit /24)

**Options :**
- **Publier ce rÃ©seau** : âœ… Cocher
  - Cela signifie que le client VPN pourra router son trafic vers ce rÃ©seau
- **Split tunneling** : âœ… Activer (recommandÃ© pour l'activitÃ©)

:::tip[Split Tunneling]
**Split tunneling** = tunnel divisÃ©

- âœ… **ActivÃ©** : Seul le trafic vers 10.Y.1.0/24 passe par le VPN
  - Avantage : Le client peut encore accÃ©der Ã  Internet directement (plus rapide)
  - Usage : TÃ©lÃ©travail, accÃ¨s ponctuel

- âŒ **DÃ©sactivÃ© (Full tunnel)** : Tout le trafic passe par le VPN
  - Avantage : ContrÃ´le total du trafic
  - InconvÃ©nient : Surcharge du VPN, plus lent
  - Usage : SÃ©curitÃ© maximale, politique stricte

Pour cette activitÃ©, le split tunneling est adaptÃ©.
:::

**3. CrÃ©er**

:::tip[Validation Ã‰tape 3.4]
- âœ… Le rÃ©seau `Reseau-Interne-Entreprise` (10.Y.1.0/24) apparaÃ®t dans la liste
- âœ… Split tunneling activÃ©
- âœ… Capture d'Ã©cran : Liste des rÃ©seaux distants configurÃ©s
:::

---

## Ã‰tape 3.5 : Configuration de l'authentification VPN

### ğŸ¯ Objectif
DÃ©finir comment les utilisateurs s'authentifieront pour accÃ©der au VPN.

### ğŸ”§ TÃ¢che : Configurer la mÃ©thode d'authentification

**1. AccÃ©der Ã  la configuration d'authentification**

```
Configuration â†’ VPN â†’ VPN SSL â†’ Onglet "Authentification"
```

**2. Choisir la mÃ©thode d'authentification**

**MÃ©thode principale :**
- **Type** : `Annuaire LDAP` (dÃ©jÃ  configurÃ© en Phase 2)
- **Annuaire** : SÃ©lectionner `Annuaire interne`

**ParamÃ¨tres d'authentification :**
- **Exiger un certificat client** : âŒ DÃ©cocher (pour simplifier)
  - En production, on activerait pour une double authentification
- **Authentification unique (SSO)** : âŒ DÃ©cocher
- **DurÃ©e de session** : `8 heures` (durÃ©e avant dÃ©connexion automatique)
- **Nombre de connexions simultanÃ©es par utilisateur** : `2`
  - Permet Ã  un utilisateur de se connecter depuis 2 appareils maximum

**3. Appliquer**

:::tip[Double authentification (bonus)]
Pour une sÃ©curitÃ© renforcÃ©e, on peut combiner :
- **Quelque chose que vous savez** : mot de passe
- **Quelque chose que vous avez** : certificat client, token OTP

Pour cette activitÃ©, le mot de passe suffit.
:::

:::tip[Validation Ã‰tape 3.5]
- âœ… MÃ©thode d'authentification : Annuaire LDAP interne
- âœ… ParamÃ¨tres de session configurÃ©s
- âœ… Capture d'Ã©cran : Page de configuration de l'authentification VPN
:::

---

## Ã‰tape 3.6 : DÃ©finition des droits d'accÃ¨s par utilisateur/groupe

### ğŸ¯ Objectif
Autoriser les utilisateurs ou groupes LDAP Ã  se connecter au VPN.

### ğŸ”§ TÃ¢che : CrÃ©er une politique d'accÃ¨s VPN

**1. AccÃ©der aux politiques d'accÃ¨s**

```
Configuration â†’ VPN â†’ VPN SSL â†’ Onglet "Politiques d'accÃ¨s"
```

**2. CrÃ©er une nouvelle politique**

Cliquer sur `Ajouter` :

**Informations gÃ©nÃ©rales :**
- **Nom** : `Acces-VPN-Groupe-Utilisateurs`
- **Description** : `Autoriser le groupe Utilisateurs_VPN Ã  se connecter`
- **Ã‰tat** : âœ… ActivÃ©

**Utilisateurs/Groupes autorisÃ©s :**
- Cliquer sur `Ajouter un groupe`
- Rechercher et sÃ©lectionner : `Utilisateurs_VPN`
  - Chemin complet : `cn=Utilisateurs_VPN,ou=groupes,dc=techservices,dc=local`
- Valider

:::tip[Groupe vs Utilisateurs individuels]
**Pourquoi utiliser un groupe plutÃ´t que des utilisateurs individuels ?**
- âœ… Gestion simplifiÃ©e : ajouter un utilisateur = l'ajouter au groupe LDAP
- âœ… ScalabilitÃ© : fonctionne pour 3 ou 300 utilisateurs
- âœ… Politique centralisÃ©e : un seul endroit Ã  modifier
:::

**Ressources accessibles :**
- **Pool d'adresses** : SÃ©lectionner `Pool-VPN-Clients`
- **RÃ©seaux accessibles** :
  - âœ… Cocher `Reseau-Interne-Entreprise` (10.Y.1.0/24)

**Options avancÃ©es :**
- **DurÃ©e maximale de connexion** : `8 heures`
- **DÃ©connexion automatique aprÃ¨s inactivitÃ©** : `30 minutes`
- **Bande passante** : IllimitÃ©e (laisser par dÃ©faut)

**3. CrÃ©er la politique**

Cliquer sur `CrÃ©er`.

**4. VÃ©rifier l'ordre des politiques**

Les politiques sont Ã©valuÃ©es de haut en bas. Si plusieurs politiques existent, la premiÃ¨re qui correspond est appliquÃ©e.

:::tip[Validation Ã‰tape 3.6]
- âœ… La politique `Acces-VPN-Groupe-Utilisateurs` est crÃ©Ã©e
- âœ… Le groupe `Utilisateurs_VPN` est associÃ©
- âœ… Le pool et le rÃ©seau interne sont configurÃ©s
- âœ… Capture d'Ã©cran : Fiche de la politique d'accÃ¨s crÃ©Ã©e
:::

---

## Ã‰tape 3.7 : Configuration du portail web VPN

### ğŸ¯ Objectif
Personnaliser la page de connexion VPN accessible via navigateur.

### ğŸ”§ TÃ¢che : Configurer le portail web

**1. AccÃ©der au portail web**

```
Configuration â†’ VPN â†’ VPN SSL â†’ Onglet "Portail web"
```

**2. Activer le portail web**

- **Activer le portail web** : âœ… Cocher
  - Permet de tÃ©lÃ©charger le client VPN et de se connecter via navigateur

**3. Personnaliser le portail (optionnel)**

**Apparence :**
- **Titre** : `VPN TechServices SARL`
- **Message de bienvenue** :
  ```
  Bienvenue sur le portail VPN de TechServices.
  Connectez-vous avec vos identifiants d'entreprise.
  ```
- **Logo** : Laisser par dÃ©faut ou uploader un logo (optionnel)

**Options :**
- **Afficher le lien de tÃ©lÃ©chargement du client** : âœ… Cocher
  - Les utilisateurs pourront tÃ©lÃ©charger OpenVPN Connect
- **Types de clients supportÃ©s** :
  - âœ… Windows
  - âœ… Linux
  - âœ… macOS
  - âœ… Android/iOS

**4. Appliquer**

:::tip[AccÃ¨s au portail web]
Une fois configurÃ©, le portail sera accessible Ã  l'adresse :
```
https://172.25.Y.254/
```
(remplacer Y par votre numÃ©ro)
:::

:::tip[Validation Ã‰tape 3.7]
- âœ… Le portail web est activÃ©
- âœ… Message de bienvenue configurÃ©
- âœ… Lien de tÃ©lÃ©chargement du client activÃ©
- âœ… Capture d'Ã©cran : Configuration du portail web
:::

---

## Ã‰tape 3.8 : VÃ©rification finale de la configuration

### ğŸ”§ TÃ¢che : Passer en revue tous les paramÃ¨tres

**1. AccÃ©der au tableau de bord VPN**

```
Monitoring â†’ VPN â†’ VPN SSL â†’ Dashboard
```

**2. VÃ©rifier l'Ã©tat du service**

Le tableau de bord doit afficher :
- **Ã‰tat du service** : ğŸŸ¢ DÃ©marrÃ© (Running)
- **Interface d'Ã©coute** : `out` (172.25.Y.254)
- **Port** : `443`
- **Connexions actives** : `0` (normal, personne n'est encore connectÃ©)
- **Utilisateurs autorisÃ©s** : `3` (jdupont, mmartin, pdurand via le groupe)

**3. VÃ©rifier le rÃ©capitulatif de configuration**

```
Configuration â†’ VPN â†’ VPN SSL â†’ Onglet "RÃ©sumÃ©"
```

Vous devez voir :
```
âœ… Service VPN SSL : ActivÃ©
âœ… Interface : out (172.25.Y.254:443)
âœ… Certificat : ConfigurÃ©
âœ… Pool d'adresses : Pool-VPN-Clients (10.Y.100.1-62)
âœ… RÃ©seaux accessibles : 10.Y.1.0/24
âœ… Authentification : LDAP interne
âœ… Politiques d'accÃ¨s : 1 politique active
âœ… Utilisateurs autorisÃ©s : Groupe Utilisateurs_VPN (3 membres)
âœ… Portail web : ActivÃ©
```

:::tip[Validation Ã‰tape 3.8]
- âœ… Tous les voyants sont au vert
- âœ… Le service VPN SSL est dÃ©marrÃ©
- âœ… Les paramÃ¨tres correspondent au plan d'adressage
- âœ… Capture d'Ã©cran : Dashboard VPN montrant l'Ã©tat du service
- âœ… Capture d'Ã©cran : Page de rÃ©sumÃ© de la configuration
:::

---

## Ã‰tape 3.9 : Test d'accÃ¨s au portail web (sans connexion)

### ğŸ”§ TÃ¢che : VÃ©rifier que le portail web est accessible

**1. Depuis la VM Client VPN (Ã‰tudiant X)**

Ouvrir un navigateur web :
```
URL : https://172.25.Y.254/
```
(remplacer Y par le numÃ©ro de votre binÃ´me Serveur)

**2. Accepter le certificat auto-signÃ©**

- Le navigateur affiche un avertissement
- Cliquer sur `AvancÃ©` â†’ `Accepter le risque`

**3. Observer la page d'accueil du portail VPN**

Vous devriez voir :
- ğŸ” Formulaire de connexion
  - Champ : Nom d'utilisateur
  - Champ : Mot de passe
  - Bouton : Se connecter
- ğŸ“¥ Lien de tÃ©lÃ©chargement du client VPN
- ğŸ’¬ Message de bienvenue (si personnalisÃ©)

**4. NE PAS SE CONNECTER ENCORE**

:::caution[Important]
Ne tentez pas de vous connecter pour l'instant.
Nous allons d'abord crÃ©er les rÃ¨gles de filtrage nÃ©cessaires en Phase 4.
:::

:::tip[Validation Ã‰tape 3.9]
- âœ… Le portail web est accessible depuis le Client VPN
- âœ… La page de login s'affiche correctement
- âœ… Le lien de tÃ©lÃ©chargement du client est visible
- âœ… Capture d'Ã©cran : Page d'accueil du portail VPN
:::

---

## âœ… Tableau de validation de la Phase 3

ComplÃ©tez ce tableau dans votre compte-rendu :

| Configuration      | ParamÃ¨tre       | Valeur attendue          | âœ…/âŒ |
| ------------------ | --------------- | ------------------------ | ----- |
| Service VPN SSL    | Ã‰tat            | ActivÃ© / DÃ©marrÃ©         |       |
| Interface d'Ã©coute | Interface       | out (172.25.Y.254)       |       |
| Port d'Ã©coute      | Port            | 443                      |       |
| Certificat SSL     | Ã‰tat            | ConfigurÃ© et valide      |       |
| Pool d'adresses    | Plage           | 10.Y.100.1 Ã  10.Y.100.62 |       |
| Pool d'adresses    | Passerelle      | 10.Y.1.254               |       |
| RÃ©seau accessible  | RÃ©seau          | 10.Y.1.0/24              |       |
| Split tunneling    | Ã‰tat            | ActivÃ©                   |       |
| Authentification   | MÃ©thode         | Annuaire LDAP interne    |       |
| Politique d'accÃ¨s  | Groupe autorisÃ© | Utilisateurs_VPN         |       |
| Politique d'accÃ¨s  | Pool associÃ©    | Pool-VPN-Clients         |       |
| Portail web        | Ã‰tat            | ActivÃ© et accessible     |       |
| Portail web        | URL             | https://172.25.Y.254/    |       |

---

## âœ… CritÃ¨res de validation de la Phase 3

Avant de passer Ã  la Phase 4, assurez-vous que :

- [ ] Le service VPN SSL est activÃ© et dÃ©marrÃ©
- [ ] L'interface OUT (172.25.Y.254) Ã©coute sur le port 443
- [ ] Un certificat SSL est configurÃ© (auto-signÃ© pour l'activitÃ©)
- [ ] Le pool d'adresses VPN est crÃ©Ã© (10.Y.100.1-62)
- [ ] Le rÃ©seau interne (10.Y.1.0/24) est dÃ©fini comme accessible
- [ ] Le split tunneling est activÃ©
- [ ] L'authentification LDAP interne est configurÃ©e
- [ ] La politique d'accÃ¨s autorise le groupe `Utilisateurs_VPN`
- [ ] La politique associe le bon pool et le bon rÃ©seau
- [ ] Le portail web est activÃ© et accessible depuis le Client VPN
- [ ] La page de login du portail s'affiche correctement

:::tip[Checkpoint enseignant]
ğŸ‘¨â€ğŸ« Avant de continuer, faites valider votre configuration par l'enseignant.
Montrez-lui :
1. Le dashboard VPN avec le service dÃ©marrÃ©
2. La configuration du pool d'adresses
3. La politique d'accÃ¨s avec le groupe autorisÃ©
4. Le portail web accessible depuis la VM Client
:::

---

## ğŸ¯ RÃ©sumÃ© de la Phase 3

Vous avez maintenant :

- âœ… Un serveur VPN SSL opÃ©rationnel
- âœ… Ã‰coute sur l'interface publique (172.25.Y.254:443)
- âœ… Certificats SSL configurÃ©s
- âœ… Pool d'adresses IP pour les clients (10.Y.100.0/26)
- âœ… RÃ©seau interne accessible via VPN (10.Y.1.0/24)
- âœ… Authentification LDAP fonctionnelle
- âœ… Politique d'accÃ¨s pour le groupe Utilisateurs_VPN
- âœ… Portail web actif et accessible

**âš ï¸ MAIS : Le VPN ne fonctionne pas encore !**

**Pourquoi ?** Il manque les **rÃ¨gles de filtrage** pour :
- Autoriser les connexions VPN entrantes sur le port 443
- Autoriser le trafic des clients VPN vers le rÃ©seau interne
- Autoriser les rÃ©ponses du rÃ©seau interne vers les clients VPN

**Prochaine Ã©tape** : Phase 4 - Configuration des rÃ¨gles de filtrage pour le VPN

---

## ğŸ“š Pour aller plus loin (bonus)

Si vous avez terminÃ© en avance :

### Bonus 1 : Comprendre le fichier de configuration OpenVPN

Le Stormshield gÃ©nÃ¨re automatiquement un fichier `.ovpn` pour les clients.

Depuis l'interface web, tÃ©lÃ©chargez le profil de configuration :
```
Configuration â†’ VPN â†’ VPN SSL â†’ Onglet "Profils clients" â†’ TÃ©lÃ©charger
```

Ouvrez-le avec un Ã©diteur de texte et observez :
```
client
dev tun
proto tcp
remote 172.25.Y.254 443
cipher AES-256-GCM
auth SHA256
...
```

Analysez chaque directive et comprenez son rÃ´le.

### Bonus 2 : Activer les logs dÃ©taillÃ©s du VPN

Pour faciliter le dÃ©pannage :
```
Configuration â†’ VPN â†’ VPN SSL â†’ Onglet "Options avancÃ©es"
```

- **Niveau de logs** : `DÃ©taillÃ© (Debug)`
- Activer tous les types de logs VPN

Ensuite, consultez :
```
Monitoring â†’ Logs â†’ VPN â†’ VPN SSL
```

### Bonus 3 : Configurer le Full Tunnel au lieu du Split Tunnel

Modifiez la configuration pour que TOUT le trafic passe par le VPN :
- DÃ©sactiver le split tunneling
- Ajouter une route par dÃ©faut (0.0.0.0/0) dans les rÃ©seaux accessibles

Observez l'impact sur la configuration client.

