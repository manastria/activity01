---
title: "Phase 0 : PrÃ©paration de l'environnement VirtualBox"
sidebar:
  order: 2
status: "draft"
level: "BTS SIO 1"
duration: "45 min"
tags: ["exemple"]
---

## Phase 0 : PrÃ©paration de l'environnement VirtualBox

### DurÃ©e estimÃ©e : 1h30

### Objectifs de cette phase

- âœ… Identifier vos numÃ©ros personnels X et Y
- âœ… CrÃ©er les machines virtuelles nÃ©cessaires
- âœ… Configurer les rÃ©seaux VirtualBox (Bridge et RÃ©seau interne)
- âœ… Installer les systÃ¨mes d'exploitation
- âœ… VÃ©rifier la connectivitÃ© de base

### Ã‰tape 0.1 : Identification du binÃ´me et des adresses rÃ©seau

#### ğŸ¯ Objectif
DÃ©terminer et noter les informations rÃ©seau qui seront utilisÃ©es dans toute l'activitÃ©.

#### Instructions

**1. Formez votre binÃ´me**

Concertez-vous avec votre binÃ´me pour dÃ©terminer les rÃ´les :
- **Ã‰tudiant X** : RÃ´le Client VPN (utilisateur nomade)
- **Ã‰tudiant Y** : RÃ´le Serveur VPN (infrastructure entreprise)

**2. ComplÃ©tez le tableau d'identification**

Recopiez et complÃ©tez ce tableau dans votre compte-rendu en utilisant **vos numÃ©ros personnels** (ceux de vos adresses rÃ©seau attribuÃ©es en dÃ©but d'annÃ©e) :
```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘           IDENTIFICATION DU BINÃ”ME - ACTIVITÃ‰ VPN           â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                             â•‘
â•‘ Ã‰tudiant X (RÃ´le : Client VPN)                              â•‘
â•‘   - Nom/PrÃ©nom : ___________________________________        â•‘
â•‘   - Mon numÃ©ro personnel X : _____                          â•‘
â•‘   - IP machine hÃ´te : 172.25.___.1/16                       â•‘
â•‘   - IP VM Client VPN : 172.25.___.10/16                     â•‘
â•‘   - IP SNS OUT : 172.25.___.254/16                          â•‘
â•‘   - IP SNS IN : 10.___.0.254/24                             â•‘
â•‘                                                             â•‘
â•Ÿâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¢
â•‘                                                             â•‘
â•‘ Ã‰tudiant Y (RÃ´le : Serveur VPN)                             â•‘
â•‘   - Nom/PrÃ©nom : ___________________________________        â•‘
â•‘   - Mon numÃ©ro personnel Y : _____                          â•‘
â•‘   - IP machine hÃ´te : 172.25.___.1/16                       â•‘
â•‘   - IP VM Serveur Debian : 10.___.1.20/24                   â•‘
â•‘   - IP SNS OUT : 172.25.___.254/16  â† Serveur VPN ici       â•‘
â•‘   - IP SNS IN : 10.___.1.254/24                             â•‘
â•‘   - Pool VPN SSL : 10.___.100.0/26                          â•‘
â•‘                                                             â•‘
â•Ÿâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¢
â•‘ URL du serveur VPN (pour connexion client) :               â•‘
â•‘   https://172.25.___.254:443                                â•‘
â•‘                                                             â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

**3. Validation par l'enseignant**

:::tip[Checkpoint]
ğŸ‘¨â€ğŸ« Avant de continuer, faites valider votre tableau par l'enseignant pour Ã©viter les conflits d'adressage.
:::

#### âœ… CritÃ¨res de validation de l'Ã©tape 0.1

Avant de passer Ã  l'Ã©tape suivante, vÃ©rifiez que :

- [ ] Vous avez notÃ© votre numÃ©ro personnel X (celui de votre rÃ©seau 172.25.X.0)
- [ ] Votre binÃ´me a notÃ© son numÃ©ro personnel Y
- [ ] Tous les champs du tableau sont remplis avec les bons masques (/16 pour le LABO, /24 pour les rÃ©seaux internes)
- [ ] Les deux numÃ©ros X et Y sont diffÃ©rents
- [ ] L'enseignant a validÃ© votre plan d'adressage

:::danger[Attention aux masques]
âš ï¸ VÃ©rifiez bien les masques rÃ©seau dans votre tableau :
- **Toutes les IPs en 172.25.x.x doivent Ãªtre en /16** (rÃ©seau LABO)
- **Toutes les IPs en 10.x.x.x doivent Ãªtre en /24** (rÃ©seaux internes privÃ©s)

Si vous vous trompez maintenant, toute l'activitÃ© devra Ãªtre refaite !
:::

---


### Ã‰tape 0.2 : CrÃ©ation des VMs pour l'Ã‰tudiant X (Client VPN)

#### ğŸ”§ TÃ¢che : Importer et configurer la VM Client VPN (XUbuntu)

**1. Importer l'image OVA**

- TÃ©lÃ©charger (si ce n'est pas dÃ©jÃ  fait) l'image de la VM XUbuntu via Torrent
- Dans VirtualBox : `Fichier` â†’ `Importer un appareil virtuel`
- SÃ©lectionner le fichier `.ova`
- **Avant d'importer**, modifier le nom : `VPN-Client-X` (remplacer X par votre numÃ©ro)
- Importer

**2. Configuration rÃ©seau de la VM**

Avant de dÃ©marrer la VM, configurez les paramÃ¨tres rÃ©seau :

- SÃ©lectionner la VM â†’ `Configuration` â†’ `RÃ©seau`
- **Adapter 1** :
  - âœ… ActivÃ©
  - Mode d'accÃ¨s rÃ©seau : `AccÃ¨s par pont`
  - Nom : SÃ©lectionner votre interface rÃ©seau physique (gÃ©nÃ©ralement `eno1` ou `eth0`)
  - Type de carte : `Paravirtualized Network (virtio-net)`
  - **âš ï¸ RÃ©gÃ©nÃ©rer l'adresse MAC** : Cliquer sur l'icÃ´ne de rafraÃ®chissement
- Adapters 2, 3, 4 : DÃ©sactivÃ©s

**3. Configurer l'IP fixe du Client VPN**

DÃ©marrer la VM et se connecter.

Configurer l'adresse IP fixe de la VM en utilisant la mÃ©thode de votre choix (interface graphique ou terminal).

**4. VÃ©rification**
```bash
ip a                          # VÃ©rifier l'IP : 172.25.X.10/16
ip route                      # VÃ©rifier la route par dÃ©faut
ping -c 4 172.25.254.254      # Ping gateway LABO
ping -c 4 8.8.8.8             # Ping Internet
```

:::tip[Validation Client VPN]
âœ… Vous devez obtenir :
- IP : 172.25.X.10/16
- Gateway : 172.25.254.254
- Ping gateway : OK
- Ping Internet : OK
:::

---
















#### ğŸ”§ TÃ¢che : Importer et configurer la VM SNS EVA1 (Ã‰tudiant X)

**Contexte :** La VM SNS EVA1 de Stormshield Academy est livrÃ©e avec un client graphique et un serveur prÃ©-configurÃ©s pour le contexte de la Stormshield Academy. Nous devons adapter cette configuration pour notre activitÃ© VPN.

**1. Importer l'image OVA du pack EVA1**

- TÃ©lÃ©charger le pack EVA1 via Torrent (si ce n'est pas dÃ©jÃ  fait)
- Importer **uniquement** les VMs suivantes :
  - Le **SNS (pare-feu)** : renommer en `SNS-Client-X`
  - Le **client graphique** : renommer en `Client-Config-X` (utilisÃ© temporairement pour la configuration)
- **Ne pas importer** le serveur sur la DMZ (non utilisÃ© dans cette activitÃ©) : il faut supprimer cette VM fournit dans le `.ova`

**2. Configuration de la VM SNS**

- SÃ©lectionner `SNS-Client-X` â†’ `Configuration`
- **SystÃ¨me** : Augmenter si possible
  - RAM : 2048 MB minimum
  - Processeur : 2 CPU

- **RÃ©seau** :
  - **Adapter 1** (Interface OUT - vers LABO/Internet) :
    - âœ… ActivÃ©
    - Mode : `AccÃ¨s par pont`
    - Nom : Votre interface physique
    - **âš ï¸ RÃ©gÃ©nÃ©rer l'adresse MAC**

  - **Adapter 2** (Interface IN - vers rÃ©seau interne) :
    - âœ… ActivÃ©
    - Mode : `RÃ©seau interne`
    - Nom : `reseau-interne-X` (âš ï¸ Remplacer X par votre numÃ©ro)
    - **âš ï¸ RÃ©gÃ©nÃ©rer l'adresse MAC**

  - Adapters 3 et 4 : DÃ©sactivÃ©s

**3. Configuration de la VM Client graphique**

- SÃ©lectionner `Client-Config-X` â†’ `Configuration`
- **RÃ©seau** :
  - **Adapter 1** :
    - Mode : `RÃ©seau interne`
    - Nom : `reseau-interne-X` (âš ï¸ MÃªme nom que l'interface IN du SNS)
    - **âš ï¸ RÃ©gÃ©nÃ©rer l'adresse MAC**

**4. Configuration initiale du SNS**

**DÃ©marrage des VMs :**
1. DÃ©marrer d'abord la VM `SNS-Client-X`
2. DÃ©marrer ensuite la VM `Client-Config-X`

**Depuis le client graphique :**
1. Lancer le script de configuration rÃ©seau (gÃ©nÃ©ralement disponible sur le bureau)
2. Choisir l'option `sns` pour obtenir une adresse IP temporaire en 10.0.0.0/8
3. Ouvrir un navigateur web
4. Se connecter Ã  : `https://10.0.0.254/admin`
   - Login : `admin`
   - Mot de passe : `admin`

**5. Reconfiguration des interfaces rÃ©seau du SNS**

Une fois connectÃ© Ã  l'interface web du SNS :

**Ã‰tape 1 : Sortir les interfaces du bridge**
- Menu : `Configuration` â†’ `RÃ©seau` â†’ `Interfaces`
- Identifier les interfaces OUT et IN (gÃ©nÃ©ralement `eth0` et `eth1`)
- Si elles sont en mode bridge, les dissocier du bridge

**Ã‰tape 2 : Configurer l'interface OUT**
- SÃ©lectionner l'interface OUT (gÃ©nÃ©ralement `eth0`)
- Type : `Statique`
- Adresse IP : `172.25.X.254`
- Masque : `255.255.0.0` (ou `/16`)
- Gateway : `172.25.254.254`
- DNS : `172.25.254.15`

**Ã‰tape 3 : Configurer l'interface IN**
- SÃ©lectionner l'interface IN (gÃ©nÃ©ralement `eth1`)
- Type : `Statique`
- Adresse IP : `10.X.0.254`
- Masque : `255.255.255.0` (ou `/24`)
- Gateway : laisser vide

**Ã‰tape 4 : Autoriser l'accÃ¨s Ã  l'interface web depuis l'interface OUT**

:::danger[Configuration critique de l'accÃ¨s]
âš ï¸ Par dÃ©faut, l'interface web du SNS n'est accessible que depuis le rÃ©seau interne (IN).
Pour pouvoir administrer le SNS depuis votre machine hÃ´te ou votre VM Client (172.25.X.x), il faut autoriser explicitement l'accÃ¨s depuis l'interface OUT.
:::

- Menu : `Configuration` â†’ `SystÃ¨me` â†’ `Administration`
- Section `Interfaces rÃ©seau d'administration` :
  - Cocher la case **OUT** (ou `eth0`) pour autoriser l'administration depuis cette interface
  - âš ï¸ Laisser **IN** cochÃ©e Ã©galement
- Vous pouvez Ã©galement limiter l'accÃ¨s par IP si nÃ©cessaire (optionnel) :
  - Activer `Filtrage par adresse IP`
  - Ajouter : `172.25.X.0/24` (votre sous-rÃ©seau personnel)

**Ã‰tape 5 : Appliquer et redÃ©marrer**
- Appliquer la configuration
- Le SNS va redÃ©marrer les services rÃ©seau
- âš ï¸ Vous allez perdre la connexion depuis le client graphique (c'est normal)

**6. VÃ©rification de la nouvelle configuration**

**Depuis votre machine hÃ´te physique :**
```bash
ping 172.25.X.254     # Doit rÃ©pondre
```

**AccÃ©der Ã  la nouvelle interface web :**
- URL : `https://172.25.X.254/admin`
- Login : `admin` / mot de passe : `admin` (ou celui que vous avez dÃ©fini)

**Depuis l'interface web du SNS, ouvrir une console systÃ¨me :**
- Menu : `Outils` â†’ `Console systÃ¨me`
- Tester :
```bash
ping 172.25.254.254   # Gateway LABO
ping 8.8.8.8          # Internet
```

**Depuis votre VM Client XUbuntu :**
```bash
ping 172.25.X.254     # Interface OUT du SNS
```

:::tip[Validation SNS Client]
âœ… Tous les pings doivent fonctionner
âœ… Vous pouvez accÃ©der Ã  l'interface web : `https://172.25.X.254/admin` depuis votre machine hÃ´te ou la VM Client
âœ… Le client graphique n'est plus nÃ©cessaire, vous pouvez l'arrÃªter (mais le conserver pour un usage futur)
:::

:::caution[RÃ©gÃ©nÃ©ration des adresses MAC]
âš ï¸ **TrÃ¨s important** : Pensez Ã  rÃ©gÃ©nÃ©rer les adresses MAC de toutes vos VMs pour Ã©viter les conflits rÃ©seau avec d'autres Ã©tudiants utilisant les mÃªmes images OVA.
:::

---

### Ã‰tape 0.3 : CrÃ©ation des VMs pour l'Ã‰tudiant Y (Serveur VPN)

#### ğŸ”§ TÃ¢che : Importer et configurer la VM SNS EVA1 (Serveur VPN principal)

**âš ï¸ Cette VM est la plus importante de l'activitÃ© : c'est elle qui hÃ©bergera le serveur VPN SSL.**

**1. Importer l'image OVA du pack EVA1**

- Importer les VMs suivantes :
  - Le **SNS (pare-feu)** : renommer en `SNS-Serveur-Y`
  - Le **client graphique** : renommer en `Client-Config-Y`
- **Ne pas importer** le serveur sur la DMZ (nous utiliserons un Debian personnalisÃ©)

**2. Configuration de la VM SNS**

- SÃ©lectionner `SNS-Serveur-Y` â†’ `Configuration`
- **SystÃ¨me** : Augmenter si possible
  - RAM : 2048 MB minimum
  - Processeur : 2 CPU

- **RÃ©seau** :
  - **Adapter 1** (OUT - Interface publique VPN) :
    - âœ… ActivÃ©
    - Mode : `AccÃ¨s par pont`
    - Nom : Votre interface physique
    - **âš ï¸ RÃ©gÃ©nÃ©rer l'adresse MAC**
    - **Cette interface recevra les connexions VPN SSL**

  - **Adapter 2** (IN - RÃ©seau entreprise) :
    - âœ… ActivÃ©
    - Mode : `RÃ©seau interne`
    - Nom : `reseau-interne-Y` (âš ï¸ Remplacer Y par votre numÃ©ro)
    - **âš ï¸ RÃ©gÃ©nÃ©rer l'adresse MAC**

  - Adapters 3 et 4 : DÃ©sactivÃ©s

**3. Configuration de la VM Client graphique**

- SÃ©lectionner `Client-Config-Y` â†’ `Configuration`
- **RÃ©seau** :
  - **Adapter 1** :
    - Mode : `RÃ©seau interne`
    - Nom : `reseau-interne-Y` (âš ï¸ MÃªme nom que l'interface IN du SNS)
    - **âš ï¸ RÃ©gÃ©nÃ©rer l'adresse MAC**

**4. Configuration initiale du SNS**

**DÃ©marrage des VMs :**
1. DÃ©marrer `SNS-Serveur-Y`
2. DÃ©marrer `Client-Config-Y`

**Depuis le client graphique :**
1. Lancer le script de configuration rÃ©seau
2. Choisir `sns` pour obtenir une IP temporaire
3. Se connecter Ã  `https://10.0.0.254/admin`
   - Login : `admin` / Mot de passe : `admin`

**5. Reconfiguration des interfaces rÃ©seau**

**Sortir les interfaces du bridge :**
- Menu : `Configuration` â†’ `RÃ©seau` â†’ `Interfaces`
- Dissocier les interfaces du bridge si nÃ©cessaire

**Configurer l'interface OUT :**
- Adresse IP : `172.25.Y.254`
- Masque : `255.255.0.0` (ou `/16`)
- Gateway : `172.25.254.254`
- DNS : `172.25.254.15`

**Configurer l'interface IN :**
- Adresse IP : `10.Y.1.254`
- Masque : `255.255.255.0` (ou `/24`)
- Gateway : laisser vide

**Appliquer et redÃ©marrer les services rÃ©seau**

**6. VÃ©rification**

Depuis votre machine hÃ´te :
```bash
ping 172.25.Y.254
```

AccÃ©der Ã  l'interface web : `https://172.25.Y.254/admin`

Depuis la console systÃ¨me du SNS :
```bash
ping 172.25.254.254
ping 8.8.8.8
```

:::tip[Validation SNS Serveur]
âœ… Les pings doivent rÃ©ussir
âœ… Interface web accessible : `https://172.25.Y.254/admin`
âœ… C'est sur cette interface OUT que le serveur VPN Ã©coutera (port 443)
:::

---

#### ğŸ”§ TÃ¢che : Importer et configurer la VM Serveur Debian (Ressources entreprise)

**1. Importer l'image OVA**

- TÃ©lÃ©charger l'image `.ova` de Debian via Torrent
- Importer dans VirtualBox
- Renommer : `Serveur-Debian-Y`

**2. Configurer la VM**

- **RÃ©seau** :
  - Adapter 1 : âœ… ActivÃ©
  - Mode : `RÃ©seau interne`
  - Nom : `reseau-interne-Y` (âš ï¸ MÃªme nom que l'interface IN du SNS)
  - **âš ï¸ RÃ©gÃ©nÃ©rer l'adresse MAC**

**3. Connexion et configuration IP**

DÃ©marrer la VM et se connecter :
- Login : `sysadmin`
- Mot de passe : `netlab123`

**Configurer l'IP fixe :**

Utiliser la mÃ©thode de votre choix pour configurer :
- Adresse IP : `10.Y.1.20/24`
- Gateway : `10.Y.1.254`
- DNS : `172.25.254.15`

**4. Installation d'Apache2**

Instructions :
1. Installer Docker si ce n'est pas dÃ©jÃ  fait
2. Cloner le dÃ©pÃ´t https://github.com/manastria/docker-http-test
3. Lancer le serveur avec `docker compose up -d`


**5. VÃ©rification**
```bash
ping 10.Y.1.254          # Ping vers le SNS IN
ping 172.25.254.254      # Ping vers la gateway LABO (doit passer via le SNS)
curl http://localhost    # Affiche la page web
```

:::tip[Validation Serveur Debian]
âœ… Ping vers le SNS : OK
âœ… Ping vers la gateway LABO : OK
âœ… Page web accessible en local : OK
:::

---



### Ã‰tape 0.4 : Validation globale de la Phase 0

#### Tests de connectivitÃ© Ã  effectuer

ComplÃ©tez le tableau suivant dans votre compte-rendu :

| Source         | Destination     | Commande              | RÃ©sultat attendu   | âœ…/âŒ |
| -------------- | --------------- | --------------------- | ------------------ | ----- |
| Client VPN (X) | Gateway LABO    | `ping 172.25.254.254` | OK                 |       |
| Client VPN (X) | SNS Client OUT  | `ping 172.25.X.254`   | OK                 |       |
| Client VPN (X) | SNS Serveur OUT | `ping 172.25.Y.254`   | OK                 |       |
| Client VPN (X) | Serveur Debian  | `ping 10.Y.1.20`      | **Ã‰CHEC** (normal) |       |
| SNS Serveur    | Gateway LABO    | `ping 172.25.254.254` | OK                 |       |
| SNS Serveur    | Internet        | `ping 8.8.8.8`        | OK                 |       |
| Serveur Debian | SNS IN          | `ping 10.Y.1.254`     | OK                 |       |
| Serveur Debian | Gateway LABO    | `ping 172.25.254.254` | OK                 |       |

:::caution[Point important]
âš ï¸ Il est **NORMAL** que le Client VPN ne puisse pas pinguer le Serveur Debian (10.Y.1.20).
**C'est justement le problÃ¨me que le VPN va rÃ©soudre !**

Le Client est sur le rÃ©seau 172.25.0.0/16 (Internet simulÃ©).
Le Serveur est sur le rÃ©seau 10.Y.1.0/24 (rÃ©seau privÃ© entreprise).
Sans VPN, ils ne peuvent pas communiquer.
:::

#### Captures d'Ã©cran Ã  inclure dans le compte-rendu

Pour cette Phase 0, incluez les captures suivantes :

1. **VirtualBox** : Vue d'ensemble de vos VMs (les 2 pour X, les 2 pour Y)
2. **VM Client** : RÃ©sultat de `ip a` et `ip route`
3. **VM SNS Serveur** : Page de login de l'interface web (`https://172.25.Y.254/admin`)
4. **VM Serveur Debian** : Page web Apache accessible en local (`curl http://localhost`)
5. **Tableau de tests** complÃ©tÃ© ci-dessus

---

### âœ… CritÃ¨res de validation de la Phase 0

Avant de passer Ã  la Phase 1, assurez-vous que :

- [ ] Toutes les VMs sont crÃ©Ã©es et dÃ©marrÃ©es correctement
- [ ] Les adresses IP sont correctement configurÃ©es selon votre plan d'adressage
- [ ] Le Client VPN peut pinguer les interfaces OUT des deux SNS
- [ ] Le Serveur Debian peut pinguer son SNS (10.Y.1.254) et la gateway LABO
- [ ] Le service Apache fonctionne sur le Serveur Debian
- [ ] Le Client VPN **ne peut PAS** pinguer le Serveur Debian (10.Y.1.20) â† **C'est normal !**
- [ ] Vous pouvez accÃ©der Ã  l'interface web du SNS Serveur depuis votre machine hÃ´te

:::tip[Checkpoint enseignant]
ğŸ‘¨â€ğŸ« Avant de continuer, faites valider votre installation par l'enseignant.
:::

---

## ğŸ¯ RÃ©sumÃ© de la Phase 0

Vous avez maintenant :

- âœ… Une infrastructure VirtualBox complÃ¨te (4 VMs par binÃ´me)
- âœ… Un rÃ©seau "Internet" simulÃ© (172.25.0.0/16 - rÃ©seau LABO)
- âœ… Un rÃ©seau d'entreprise isolÃ© (10.Y.1.0/24)
- âœ… Un client VPN sur "Internet" qui ne peut pas accÃ©der aux ressources internes
- âœ… Un serveur web d'entreprise inaccessible depuis l'extÃ©rieur

**Prochaine Ã©tape** : Phase 1 - Configuration rÃ©seau avancÃ©e et premiÃ¨res rÃ¨gles de filtrage




