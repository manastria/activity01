---
title: "ActivitÃ© - Mise en place d'un VPN SSL avec Stormshield EVA1"
description: "Guide complet pour configurer un VPN SSL permettant l'accÃ¨s sÃ©curisÃ© aux ressources d'entreprise"
sidebar:
  order: 1
status: "draft"
level: "BTS SIO 1"
duration: "45 min"
tags: ["exemple"]
---

# ActivitÃ© - Mise en place d'un VPN SSL avec Stormshield EVA1

## Informations gÃ©nÃ©rales

- **DurÃ©e estimÃ©e** : 8 Ã  12 heures
- **Niveau** : BTS SIO SISR
- **PrÃ©requis** : Configuration rÃ©seau de base, rÃ¨gles de filtrage, NAT
- **ModalitÃ©** : Travail en binÃ´me
- **Livrable** : Compte-rendu d'activitÃ©

---

## Contexte professionnel

### PrÃ©sentation de l'entreprise

**TechServices SARL** est une entreprise de services informatiques qui compte aujourd'hui 45 collaborateurs rÃ©partis sur deux sites :

- **SiÃ¨ge social Ã  Paris** (40 personnes) : hÃ©berge le serveur de fichiers principal, l'ERP de gestion et l'infrastructure rÃ©seau centrale
- **Agence de Lyon** (5 personnes) : petite Ã©quipe commerciale qui doit accÃ©der quotidiennement aux ressources du siÃ¨ge

### ProblÃ©matique

L'entreprise fait face Ã  plusieurs dÃ©fis :

1. **SÃ©curitÃ© des donnÃ©es** : Les collaborateurs de Lyon accÃ¨dent actuellement aux ressources via des connexions non sÃ©curisÃ©es sur Internet
2. **Risques identifiÃ©s** :
   - Interception possible des donnÃ©es sensibles (devis, contrats clients)
   - Absence d'authentification forte
   - Pas de traÃ§abilitÃ© des accÃ¨s
3. **Contraintes budgÃ©taires** : Pas de budget pour une liaison dÃ©diÃ©e ou un VPN site-Ã -site matÃ©riel
4. **Ã‰volution** : DÃ©ploiement futur du tÃ©lÃ©travail pour 10 collaborateurs supplÃ©mentaires

### Solution proposÃ©e

Mise en place d'un **VPN SSL** (Virtual Private Network - Secure Sockets Layer) permettant :

- âœ… Authentification forte des utilisateurs (login/mot de passe + certificats)
- âœ… Chiffrement de bout en bout des communications
- âœ… AccÃ¨s sÃ©curisÃ© aux ressources internes depuis n'importe oÃ¹
- âœ… Solution Ã©conomique (logiciel uniquement)
- âœ… Ã‰volutivitÃ© pour le tÃ©lÃ©travail

---

## Objectifs pÃ©dagogiques

### CompÃ©tences techniques visÃ©es

Ã€ l'issue de cette activitÃ©, vous serez capable de :

1. **Comprendre** les principes et l'utilitÃ© d'un VPN SSL en entreprise
2. **Configurer** un annuaire LDAP interne sur Stormshield pour gÃ©rer les utilisateurs
3. **Mettre en Å“uvre** un serveur VPN SSL sur un pare-feu Stormshield EVA1
4. **DÃ©finir** les rÃ¨gles de filtrage adaptÃ©es pour sÃ©curiser les accÃ¨s VPN
5. **Installer et configurer** un client VPN (OpenVPN Connect)
6. **Valider** le bon fonctionnement d'une infrastructure VPN
7. **Documenter** une configuration rÃ©seau complexe

### CompÃ©tences transversales

- Autonomie dans la rÃ©solution de problÃ¨mes rÃ©seau
- Rigueur dans la configuration de services de sÃ©curitÃ©
- MÃ©thodologie de tests et validation
- RÃ©daction technique professionnelle

---

## Architecture de l'infrastructure

### SchÃ©ma rÃ©seau global

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    RÃ‰SEAU LABO (PHYSIQUE)                          â”‚
â”‚                      172.25.0.0/16                                 â”‚
â”‚                    Gateway: 172.25.254.254                         â”‚
â”‚                       DNS: 172.25.254.15                           â”‚
â”‚                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚  MACHINE HÃ”TE           â”‚      â”‚  MACHINE HÃ”TE          â”‚       â”‚
â”‚  â”‚  Ã‰tudiant X             â”‚      â”‚  Ã‰tudiant Y            â”‚       â”‚
â”‚  â”‚  XUbuntu (physique)     â”‚      â”‚  XUbuntu (physique)    â”‚       â”‚
â”‚  â”‚  IP: 172.25.X.1         â”‚      â”‚  IP: 172.25.Y.1        â”‚       â”‚
â”‚  â”‚                         â”‚      â”‚                        â”‚       â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚      â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚       â”‚
â”‚  â”‚  â”‚   VirtualBox      â”‚  â”‚      â”‚  â”‚   VirtualBox     â”‚  â”‚       â”‚
â”‚  â”‚  â”‚                   â”‚  â”‚      â”‚  â”‚                  â”‚  â”‚       â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚      â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚       â”‚
â”‚  â”‚  â”‚  â”‚ VM Client  â”‚   â”‚  â”‚      â”‚  â”‚  â”‚ VM Serveur â”‚  â”‚  â”‚       â”‚
â”‚  â”‚  â”‚  â”‚ VPN        â”‚   â”‚  â”‚      â”‚  â”‚  â”‚ Debian 12  â”‚  â”‚  â”‚       â”‚
â”‚  â”‚  â”‚  â”‚ XUbuntu    â”‚â—„â”€â”€â”¼â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”¼â”€â”€â”¤            â”‚  â”‚  â”‚       â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚      â”‚  â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚       â”‚
â”‚  â”‚  â”‚        â”‚(Bridge)  â”‚  â”‚ VPN  â”‚  â”‚        â”‚(Interne)â”‚  â”‚       â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚ SSL  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚       â”‚
â”‚  â”‚  â”‚  â”‚  SNS EVA1  â”‚   â”‚  â”‚      â”‚  â”‚  â”‚  SNS EVA1  â”‚  â”‚  â”‚       â”‚
â”‚  â”‚  â”‚  â”‚            â”‚â—„â”€â”€â”¼â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”¼â”€â–ºâ”‚            â”‚  â”‚  â”‚       â”‚
â”‚  â”‚  â”‚  â”‚ OUT  IN    â”‚   â”‚  â”‚(LABO)â”‚  â”‚  â”‚ OUT  IN    â”‚  â”‚  â”‚       â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚      â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚       â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚      â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### RÃ©partition des rÃ´les

#### ğŸ‘¤ Ã‰tudiant X - RÃ´le : Client VPN (utilisateur nomade)

**MatÃ©riel** : 
- 1 machine hÃ´te XUbuntu physique (IP : 172.25.X.1)
- 2 machines virtuelles VirtualBox

**VM 1 - Client VPN** :
- OS : XUbuntu Desktop
- RÃ©seau : AccÃ¨s par pont (Bridge) â†’ rÃ©seau LABO
- IP : 172.25.X.10/16 (fixe)
- Gateway : 172.25.254.254
- DNS : 172.25.254.15
- Logiciel : OpenVPN Connect
- RÃ´le : Simule un poste utilisateur distant (tÃ©lÃ©travail, agence)

**VM 2 - SNS EVA1** :
- OS : Stormshield EVA1
- Interface OUT : 
  - RÃ©seau : AccÃ¨s par pont (Bridge)
  - IP : 172.25.X.254/16
  - Gateway : 172.25.254.254
- Interface IN :
  - RÃ©seau : RÃ©seau interne VirtualBox (nom : `reseau-interne-X`)
  - IP : 10.X.0.254/24
- RÃ´le : Pare-feu de test (non utilisÃ© pour le VPN ici)

---

#### ğŸ‘¤ Ã‰tudiant Y - RÃ´le : Serveur VPN / Entreprise

**MatÃ©riel** :
- 1 machine hÃ´te XUbuntu physique (IP : 172.25.Y.1)
- 2 machines virtuelles VirtualBox

**VM 1 - Serveur de ressources** :
- OS : Debian 12 Server minimal
- RÃ©seau : RÃ©seau interne VirtualBox (nom : `reseau-interne-Y`)
- IP : 10.Y.1.20/24 (fixe)
- Gateway : 10.Y.1.254 (SNS IN)
- DNS : 172.25.254.15
- Services : Apache2, SSH
- RÃ´le : Serveur web/fichiers de l'entreprise (ressource Ã  protÃ©ger)

**VM 2 - SNS EVA1** :
- OS : Stormshield EVA1
- Interface OUT :
  - RÃ©seau : AccÃ¨s par pont (Bridge)
  - IP : 172.25.Y.254/16
  - Gateway : 172.25.254.254
  - **Serveur VPN SSL Ã©coute ici** (443/TCP)
- Interface IN :
  - RÃ©seau : RÃ©seau interne VirtualBox (nom : `reseau-interne-Y`)
  - IP : 10.Y.1.254/24
- RÃ´le : Pare-feu principal + Serveur VPN SSL

---

## Plan d'adressage

### Comprendre votre adresse rÃ©seau personnelle

**Rappel important :** En dÃ©but d'annÃ©e, chaque Ã©tudiant s'est vu attribuer une plage d'adresses rÃ©seau personnelle au format `172.25.X.0/24` oÃ¹ **X est votre numÃ©ro personnel**.

Cette plage `/24` indique votre "zone" dans le rÃ©seau LABO, mais **toutes vos configurations rÃ©seau doivent utiliser le masque `/16`** pour communiquer avec l'ensemble du LABO (gateway, DNS, autres Ã©tudiants).

:::tip[Retrouver votre numÃ©ro X]
Si vous ne vous souvenez plus de votre numÃ©ro personnel X :
- VÃ©rifiez dans vos notes du dÃ©but d'annÃ©e
- Consultez le fichier partagÃ© par l'enseignant
- Regardez la configuration IP actuelle de votre machine hÃ´te : `ip a`
  - Si vous voyez `172.25.42.1/16`, alors votre X = 42
:::

**Pourquoi utiliser /16 et pas /24 ?**

Le rÃ©seau LABO est un grand rÃ©seau `172.25.0.0/16` qui contient tous les Ã©tudiants :
- Le masque `/16` signifie que les deux premiers octets sont fixes : `172.25`
- Les deux derniers octets sont variables : de `0.0` Ã  `255.255`
- Cela permet 65 536 adresses au total

**Si vous configurez en /24 au lieu de /16, vous ne pourrez pas :**
- âŒ Pinguer la gateway `172.25.254.254` (elle sera considÃ©rÃ©e hors rÃ©seau)
- âŒ Communiquer avec votre binÃ´me (172.25.Y.x sera hors rÃ©seau)
- âŒ AccÃ©der Ã  Internet

**Configuration correcte :**
- âœ… Adresse IP : `172.25.X.10`
- âœ… Masque rÃ©seau : `255.255.0.0` (soit `/16`)
- âœ… Gateway : `172.25.254.254`
- âœ… DNS : `172.25.254.15`

:::caution[Conservation de l'information]
**Votre numÃ©ro X est rÃ©utilisÃ© dans toutes les activitÃ©s rÃ©seau de l'annÃ©e.**
Le `/24` indique juste votre "zone" attribuÃ©e, mais vous configurez toujours en `/16` !
:::

---

### Tableau d'adressage pour l'activitÃ© VPN

| Ã‰lÃ©ment                   | Ã‰tudiant X (Client)          | Ã‰tudiant Y (Serveur)            |
|---------------------------|------------------------------|---------------------------------|
| **Machine hÃ´te physique** | 172.25.X.1/16                | 172.25.Y.1/16                   |
| **VM Client VPN**         | 172.25.X.10/16 (Bridge)      | -                               |
| **VM Serveur Debian**     | -                            | 10.Y.1.20/24 (Interne)          |
| **SNS Interface OUT**     | 172.25.X.254/16 (Bridge)     | 172.25.Y.254/16 (Bridge)        |
| **SNS Interface IN**      | 10.X.0.254/24 (Interne)      | 10.Y.1.254/24 (Interne)         |
| **Pool VPN SSL**          | -                            | 10.Y.100.0/26 (64 adresses max) |

**LÃ©gende des masques :**
- `/16` : UtilisÃ© pour le rÃ©seau LABO (172.25.0.0/16) - permet communication avec gateway et autres Ã©tudiants
- `/24` : UtilisÃ© pour les rÃ©seaux internes privÃ©s (10.X.0.0/24, 10.Y.1.0/24) - isolÃ©s du LABO
- `/26` : UtilisÃ© pour le pool VPN (64 adresses) - sous-rÃ©seau du rÃ©seau interne Y

:::tip[Exemple concret pour un binÃ´me]
**Exemple :** Vous Ãªtes Sarah (X=15) et travaillez avec Lucas (Y=27)

**Configuration Sarah (Client VPN) :**
- VM Client : `172.25.15.10/16` â† **masque /16 obligatoire**
  - Gateway : `172.25.254.254`
  - DNS : `172.25.254.15`
- SNS OUT : `172.25.15.254/16`
- SNS IN : `10.15.0.254/24` (rÃ©seau privÃ©, non utilisÃ© ici)

**Configuration Lucas (Serveur VPN) :**
- VM Serveur Debian : `10.27.1.20/24` â† **masque /24 (rÃ©seau privÃ©)**
  - Gateway : `10.27.1.254` (son SNS IN)
  - DNS : `172.25.254.15` (via le SNS)
- SNS OUT : `172.25.27.254/16` â† **masque /16** + Serveur VPN Ã©coute ici
  - Gateway : `172.25.254.254`
- SNS IN : `10.27.1.254/24` â† **rÃ©seau privÃ© entreprise**
- Pool clients VPN : `10.27.100.0/26` (IPs de .1 Ã  .62)

**Flux de connexion VPN :**
1. Sarah (172.25.15.10) se connecte vers 172.25.27.254:443 (serveur VPN de Lucas)
2. Une fois le tunnel Ã©tabli, Sarah obtient une IP du pool : 10.27.100.5
3. Sarah peut maintenant accÃ©der au serveur Debian : 10.27.1.20
:::
---

## Phase 0 : PrÃ©paration de l'environnement VirtualBox

### DurÃ©e estimÃ©e : 1h30

### Objectifs de cette phase

- âœ… Identifier vos numÃ©ros personnels X et Y
- âœ… CrÃ©er les machines virtuelles nÃ©cessaires
- âœ… Configurer les rÃ©seaux VirtualBox (Bridge et RÃ©seau interne)
- âœ… Installer les systÃ¨mes d'exploitation
- âœ… VÃ©rifier la connectivitÃ© de base

### Ã‰tape 0.1 : Identification du binÃ´me et des adresses rÃ©seau

#### ğŸ¯ Objectif
DÃ©terminer et noter les informations rÃ©seau qui seront utilisÃ©es dans toute l'activitÃ©.

#### Instructions

**1. Formez votre binÃ´me**

Concertez-vous avec votre binÃ´me pour dÃ©terminer les rÃ´les :
- **Ã‰tudiant X** : RÃ´le Client VPN (utilisateur nomade)
- **Ã‰tudiant Y** : RÃ´le Serveur VPN (infrastructure entreprise)

**2. ComplÃ©tez le tableau d'identification**

Recopiez et complÃ©tez ce tableau dans votre compte-rendu en utilisant **vos numÃ©ros personnels** (ceux de vos adresses rÃ©seau attribuÃ©es en dÃ©but d'annÃ©e) :
```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘           IDENTIFICATION DU BINÃ”ME - ACTIVITÃ‰ VPN           â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                             â•‘
â•‘ Ã‰tudiant X (RÃ´le : Client VPN)                              â•‘
â•‘   - Nom/PrÃ©nom : ___________________________________        â•‘
â•‘   - Mon numÃ©ro personnel X : _____                          â•‘
â•‘   - IP machine hÃ´te : 172.25.___.1/16                       â•‘
â•‘   - IP VM Client VPN : 172.25.___.10/16                     â•‘
â•‘   - IP SNS OUT : 172.25.___.254/16                          â•‘
â•‘   - IP SNS IN : 10.___.0.254/24                             â•‘
â•‘                                                             â•‘
â•Ÿâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¢
â•‘                                                             â•‘
â•‘ Ã‰tudiant Y (RÃ´le : Serveur VPN)                             â•‘
â•‘   - Nom/PrÃ©nom : ___________________________________        â•‘
â•‘   - Mon numÃ©ro personnel Y : _____                          â•‘
â•‘   - IP machine hÃ´te : 172.25.___.1/16                       â•‘
â•‘   - IP VM Serveur Debian : 10.___.1.20/24                   â•‘
â•‘   - IP SNS OUT : 172.25.___.254/16  â† Serveur VPN ici       â•‘
â•‘   - IP SNS IN : 10.___.1.254/24                             â•‘
â•‘   - Pool VPN SSL : 10.___.100.0/26                          â•‘
â•‘                                                             â•‘
â•Ÿâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¢
â•‘ URL du serveur VPN (pour connexion client) :               â•‘
â•‘   https://172.25.___.254:443                                â•‘
â•‘                                                             â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

**3. Validation par l'enseignant**

:::tip[Checkpoint]
ğŸ‘¨â€ğŸ« Avant de continuer, faites valider votre tableau par l'enseignant pour Ã©viter les conflits d'adressage.
:::

#### âœ… CritÃ¨res de validation de l'Ã©tape 0.1

Avant de passer Ã  l'Ã©tape suivante, vÃ©rifiez que :

- [ ] Vous avez notÃ© votre numÃ©ro personnel X (celui de votre rÃ©seau 172.25.X.0)
- [ ] Votre binÃ´me a notÃ© son numÃ©ro personnel Y
- [ ] Tous les champs du tableau sont remplis avec les bons masques (/16 pour le LABO, /24 pour les rÃ©seaux internes)
- [ ] Les deux numÃ©ros X et Y sont diffÃ©rents
- [ ] L'enseignant a validÃ© votre plan d'adressage

:::danger[Attention aux masques]
âš ï¸ VÃ©rifiez bien les masques rÃ©seau dans votre tableau :
- **Toutes les IPs en 172.25.x.x doivent Ãªtre en /16** (rÃ©seau LABO)
- **Toutes les IPs en 10.x.x.x doivent Ãªtre en /24** (rÃ©seaux internes privÃ©s)

Si vous vous trompez maintenant, toute l'activitÃ© devra Ãªtre refaite !
:::

---


### Ã‰tape 0.2 : CrÃ©ation des VMs pour l'Ã‰tudiant X (Client VPN)

#### ğŸ”§ TÃ¢che : Importer et configurer la VM Client VPN (XUbuntu)

**1. Importer l'image OVA**

- TÃ©lÃ©charger (si ce n'est pas dÃ©jÃ  fait) l'image de la VM XUbuntu via Torrent
- Dans VirtualBox : `Fichier` â†’ `Importer un appareil virtuel`
- SÃ©lectionner le fichier `.ova`
- **Avant d'importer**, modifier le nom : `VPN-Client-X` (remplacer X par votre numÃ©ro)
- Importer

**2. Configuration rÃ©seau de la VM**

Avant de dÃ©marrer la VM, configurez les paramÃ¨tres rÃ©seau :

- SÃ©lectionner la VM â†’ `Configuration` â†’ `RÃ©seau`
- **Adapter 1** :
  - âœ… ActivÃ©
  - Mode d'accÃ¨s rÃ©seau : `AccÃ¨s par pont`
  - Nom : SÃ©lectionner votre interface rÃ©seau physique (gÃ©nÃ©ralement `eno1` ou `eth0`)
  - Type de carte : `Paravirtualized Network (virtio-net)`
  - **âš ï¸ RÃ©gÃ©nÃ©rer l'adresse MAC** : Cliquer sur l'icÃ´ne de rafraÃ®chissement
- Adapters 2, 3, 4 : DÃ©sactivÃ©s

**3. Configurer l'IP fixe du Client VPN**

DÃ©marrer la VM et se connecter.

Configurer l'adresse IP fixe de la VM en utilisant la mÃ©thode de votre choix (interface graphique ou terminal).

**4. VÃ©rification**
```bash
ip a                          # VÃ©rifier l'IP : 172.25.X.10/16
ip route                      # VÃ©rifier la route par dÃ©faut
ping -c 4 172.25.254.254      # Ping gateway LABO
ping -c 4 8.8.8.8             # Ping Internet
```

:::tip[Validation Client VPN]
âœ… Vous devez obtenir :
- IP : 172.25.X.10/16
- Gateway : 172.25.254.254
- Ping gateway : OK
- Ping Internet : OK
:::

---

#### ğŸ”§ TÃ¢che : Importer et configurer la VM SNS EVA1 (Ã‰tudiant X)

**1. Importer l'image OVA**

- TÃ©lÃ©charger la VM SNS EVA1 via Torrent
- Importer dans VirtualBox
- Renommer : `SNS-Client-X` (remplacer X)
- Augmenter la RAM et le nombre de CPU si possible (2048 MB RAM, 2 CPU)
- Le client graphique servira uniquement Ã  la configuration initiale
- Vous pouvez dÃ©jÃ  supprimer le serveur sur la DMZ, il ne sera pas utilisÃ© ici

**2. Configuration rÃ©seau de la VM**

- **Adapter 1** (Interface OUT - vers LABO/Internet) :
  - âœ… ActivÃ©
  - Mode : `AccÃ¨s par pont`
  - Nom : Votre interface physique
  - **âš ï¸ RÃ©gÃ©nÃ©rer l'adresse MAC**
  
- **Adapter 2** (Interface IN - vers rÃ©seau interne) :
  - âœ… ActivÃ©
  - Mode : `RÃ©seau interne`
  - Nom : `reseau-interne-X` (âš ï¸ Remplacer X par votre numÃ©ro)
  - **âš ï¸ RÃ©gÃ©nÃ©rer l'adresse MAC**
  
- Adapters 3 et 4 : DÃ©sactivÃ©s

**3. Configuration initiale du SNS (en console)**

DÃ©marrer la VM client graphique livrÃ©e avec le SNS.
DÃ©marrer la VM SNS EVA1 (console).

Ã€ partir du client graphique, lancer le script de configuration et choisir `sns` pour obtenir un adresse IP en 10.0.0.0/8 temporaire.

Se conntecter Ã  l'adresse https://10.0.0.254/admin

Se connecter :
- Login : `admin`
- Mot de passe : `admin`

**Configuration interfaces :**

Sortir les interfaces du _bridge_

**Interface OUT :**
```
Type : IP fixe (y)
Adresse IP : 172.25.X.254
Masque : 255.255.0.0
Gateway : 172.25.254.254
```

**Interface IN :**
```
Type : IP fixe (y)
Adresse IP : 10.X.0.254
Masque : 255.255.255.0
Gateway : [laisser vide]
```

**4. VÃ©rification**

Depuis la console SNS :
```bash
ping 172.25.254.254   # Gateway LABO
ping 8.8.8.8          # Internet
```

Depuis votre VM Client :
```bash
ping 172.25.X.254     # Interface OUT du SNS
```

:::tip[Validation SNS Client]
âœ… Les trois pings doivent fonctionner
âœ… Vous pouvez accÃ©der Ã  l'interface web : `https://172.25.X.254/admin` (depuis votre machine hÃ´te ou la VM Client)
:::

:::caution[RÃ©gÃ©nÃ©ration des adresses MAC]
âš ï¸ **TrÃ¨s important** : Pensez Ã  rÃ©gÃ©nÃ©rer les adresses MAC de toutes vos VMs pour Ã©viter les conflits rÃ©seau avec d'autres Ã©tudiants utilisant les mÃªmes images OVA.
:::

---

### Ã‰tape 0.3 : CrÃ©ation des VMs pour l'Ã‰tudiant Y (Serveur VPN)

#### ğŸ”§ TÃ¢che : CrÃ©er VM SNS EVA1 pour Ã‰tudiant Y (Serveur VPN principal)

**Cette VM est la plus importante de l'activitÃ© : c'est elle qui hÃ©bergera le serveur VPN SSL.**

- TÃ©lÃ©charger (si ce n'est pas dÃ©jÃ  fait) l'image de la VM SNS via Torrent
- Supprimer la VM serveur sur la DMZ (non utilisÃ©e ici)

2. **Configurer les interfaces rÃ©seau** :
   - **Adapter 1** (OUT - Interface publique VPN) :
     - âœ… ActivÃ©
     - Mode : `AccÃ¨s par pont`
     - Nom : Votre interface physique
     - **Cette interface recevra les connexions VPN SSL**
   - **Adapter 2** (IN - RÃ©seau entreprise) :
     - âœ… ActivÃ©
     - Mode : `RÃ©seau interne`
     - Nom : `reseau-interne-Y` (âš ï¸ Remplacer Y)
   - Adapters 3 et 4 : DÃ©sactivÃ©s

3. **DÃ©marrer la VM SNS** et effectuer la configuration initiale :
   - DÃ©marrer le client graphique livrÃ© avec le SNS
   - Configuration interfaces :
     - **Interface OUT** :
       - IP : `172.25.Y.254`
       - Masque : `255.255.0.0`
       - Gateway : `172.25.254.254`
     - **Interface IN** :
       - IP : `10.Y.1.254`
       - Masque : `255.255.255.0`
       - Gateway : laisser vide

4. **VÃ©rifier la connectivitÃ©** depuis la console SNS :
   ```bash
   ping 172.25.254.254
   ping 8.8.8.8
   ```

:::tip[Validation SNS Serveur]
âœ… Les deux pings doivent rÃ©ussir
âœ… Notez l'URL d'administration : `https://172.25.Y.254/admin`
:::

---

#### ğŸ”§ TÃ¢che : CrÃ©er VM Serveur Debian (Ressources entreprise)

1. TÃ©lÃ©charger l'image `.ova` de Debian via Torrent.

2. **Configurer la VM** :
   - **RÃ©seau** :
     - Adapter 1 : âœ… ActivÃ©
     - Mode : `RÃ©seau interne`
     - Nom : `reseau-interne-Y` (âš ï¸ MÃªme nom que l'interface IN du SNS)

Rappel pour la connexion utilisateur :
- Login : `sysadmin`
- Mot de passe : `netlab123`


6. **Configurer l'IP fixe du serveur** :
   
       address 10.Y.1.20
       netmask 255.255.255.0
       gateway 10.Y.1.254
       dns-nameservers 172.25.254.15

7. **Installer Apache2** :
   TODO : Installer le serveur web Apache2 avec Docker

8. **CrÃ©er une page web de test** :
   ```bash
   echo "<h1>Serveur TechServices - Ressource interne</h1>" > /var/www/html/index.html
   echo "<p>Si vous voyez cette page, le VPN fonctionne !</p>" >> /var/www/html/index.html
   ```

:::tip[Validation Serveur Debian]
âœ… Depuis le serveur, testez :
```bash
ping 10.Y.1.254          # Ping vers le SNS
ping 172.25.254.254      # Ping vers la gateway LABO (doit passer via le SNS)
curl http://localhost    # Affiche la page web
```
:::

---

### Ã‰tape 0.4 : Validation globale de la Phase 0

#### Tests de connectivitÃ© Ã  effectuer

ComplÃ©tez le tableau suivant dans votre compte-rendu :

| Source | Destination | Commande | RÃ©sultat attendu | âœ…/âŒ |
|--------|-------------|----------|------------------|------|
| Client VPN (X) | Gateway LABO | `ping 172.25.254.254` | OK | |
| Client VPN (X) | SNS Client OUT | `ping 172.25.X.254` | OK | |
| Client VPN (X) | SNS Serveur OUT | `ping 172.25.Y.254` | OK | |
| Client VPN (X) | Serveur Debian | `ping 10.Y.1.20` | **Ã‰CHEC** (normal) | |
| SNS Serveur | Gateway LABO | `ping 172.25.254.254` | OK | |
| SNS Serveur | Internet | `ping 8.8.8.8` | OK | |
| Serveur Debian | SNS IN | `ping 10.Y.1.254` | OK | |
| Serveur Debian | Gateway LABO | `ping 172.25.254.254` | OK | |

:::caution[Point important]
âš ï¸ Il est **NORMAL** que le Client VPN ne puisse pas pinguer le Serveur Debian (10.Y.1.20).
**C'est justement le problÃ¨me que le VPN va rÃ©soudre !**

Le Client est sur le rÃ©seau 172.25.0.0/16 (Internet simulÃ©).
Le Serveur est sur le rÃ©seau 10.Y.1.0/24 (rÃ©seau privÃ© entreprise).
Sans VPN, ils ne peuvent pas communiquer.
:::

#### Captures d'Ã©cran Ã  inclure dans le compte-rendu

Pour cette Phase 0, incluez les captures suivantes :

1. **VirtualBox** : Vue d'ensemble de vos VMs (les 2 pour X, les 2 pour Y)
2. **VM Client** : RÃ©sultat de `ip a` et `ip route`
3. **VM SNS Serveur** : Page de login de l'interface web (`https://172.25.Y.254/admin`)
4. **VM Serveur Debian** : Page web Apache accessible en local (`curl http://localhost`)
5. **Tableau de tests** complÃ©tÃ© ci-dessus

---

### âœ… CritÃ¨res de validation de la Phase 0

Avant de passer Ã  la Phase 1, assurez-vous que :

- [ ] Toutes les VMs sont crÃ©Ã©es et dÃ©marrÃ©es correctement
- [ ] Les adresses IP sont correctement configurÃ©es selon votre plan d'adressage
- [ ] Le Client VPN peut pinguer les interfaces OUT des deux SNS
- [ ] Le Serveur Debian peut pinguer son SNS (10.Y.1.254) et la gateway LABO
- [ ] Le service Apache fonctionne sur le Serveur Debian
- [ ] Le Client VPN **ne peut PAS** pinguer le Serveur Debian (10.Y.1.20) â† **C'est normal !**
- [ ] Vous pouvez accÃ©der Ã  l'interface web du SNS Serveur depuis votre machine hÃ´te

:::tip[Checkpoint enseignant]
ğŸ‘¨â€ğŸ« Avant de continuer, faites valider votre installation par l'enseignant.
:::

---

## ğŸ¯ RÃ©sumÃ© de la Phase 0

Vous avez maintenant :

- âœ… Une infrastructure VirtualBox complÃ¨te (4 VMs par binÃ´me)
- âœ… Un rÃ©seau "Internet" simulÃ© (172.25.0.0/16 - rÃ©seau LABO)
- âœ… Un rÃ©seau d'entreprise isolÃ© (10.Y.1.0/24)
- âœ… Un client VPN sur "Internet" qui ne peut pas accÃ©der aux ressources internes
- âœ… Un serveur web d'entreprise inaccessible depuis l'extÃ©rieur

**Prochaine Ã©tape** : Phase 1 - Configuration rÃ©seau avancÃ©e et premiÃ¨res rÃ¨gles de filtrage

---

*Document gÃ©nÃ©rÃ© pour BTS SIO SISR - ActivitÃ© VPN SSL Stormshield EVA1*