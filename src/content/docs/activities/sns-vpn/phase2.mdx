---
title: "Phase 2 - Configuration LDAP et utilisateurs VPN"
description: "Configuration de l'annuaire LDAP interne du Stormshield et crÃ©ation des utilisateurs pour l'authentification VPN SSL"
---

# Phase 2 : Configuration LDAP interne et utilisateurs VPN

## Informations

- **DurÃ©e estimÃ©e** : 1h30
- **PrÃ©requis** : Phase 1 terminÃ©e et validÃ©e
- **RÃ´le principal** : Ã‰tudiant Y (Serveur VPN)

---

## Objectifs de cette phase

- âœ… Comprendre le rÃ´le de l'authentification dans un VPN
- âœ… Activer et configurer l'annuaire LDAP interne du SNS
- âœ… CrÃ©er des utilisateurs pour l'accÃ¨s VPN
- âœ… CrÃ©er des groupes d'utilisateurs
- âœ… Tester l'authentification via le portail captif
- âœ… PrÃ©parer les comptes pour la connexion VPN SSL

---

## Contexte : Pourquoi un annuaire LDAP ?

### Rappel du besoin mÃ©tier

Dans le contexte de l'entreprise **TechServices SARL** :
- Les collaborateurs de l'agence de Lyon doivent accÃ©der aux ressources du siÃ¨ge
- Les tÃ©lÃ©travailleurs doivent pouvoir se connecter depuis leur domicile
- **Besoin d'authentification forte** : vÃ©rifier l'identitÃ© avant d'autoriser l'accÃ¨s

### Qu'est-ce que LDAP ?

**LDAP** (_Lightweight Directory Access Protocol_) est un protocole qui permet :
- De stocker des informations sur les utilisateurs (nom, prÃ©nom, login, mot de passe, etc.)
- D'organiser ces utilisateurs en groupes
- D'authentifier ces utilisateurs (vÃ©rifier leur identitÃ©)

### Choix de l'annuaire interne du SNS

Le Stormshield propose deux options :
1. **Annuaire externe** (Active Directory, OpenLDAP) : pour les grandes entreprises
2. **Annuaire interne** : intÃ©grÃ© au firewall, simple Ã  configurer

Pour cette activitÃ©, nous utilisons l'**annuaire interne** car :
- âœ… Simple et rapide Ã  mettre en place
- âœ… Pas besoin de serveur supplÃ©mentaire
- âœ… Parfait pour une PME ou un POC (_Proof of Concept_)

:::tip[En production]
Dans une vraie entreprise, on connecterait gÃ©nÃ©ralement le SNS Ã  l'Active Directory existant pour centraliser la gestion des utilisateurs.
:::

---

## Ã‰tape 2.1 : Activation de l'annuaire LDAP interne

:::caution[RÃ´le spÃ©cifique]
**Cette phase est rÃ©alisÃ©e par l'Ã‰tudiant Y** (Serveur VPN).
L'Ã‰tudiant X observe ou prend des notes.
:::

### ğŸ”§ TÃ¢che : Activer le module LDAP

**1. Se connecter Ã  l'interface web du SNS**

```
URL : https://172.25.Y.254/admin
Login : admin
Mot de passe : admin
```

**2. AccÃ©der Ã  la configuration de l'annuaire**

Menu de gauche :
```
Configuration â†’ Utilisateurs â†’ Annuaire
```

**3. Activer l'annuaire interne**

Onglet **Annuaire interne** :

- **Activer l'annuaire LDAP interne** : âœ… Cocher
- **Base DN** (_Distinguished Name_) : DÃ©finir la racine de l'annuaire
  - Format : `dc=techservices,dc=local`
  - Explication : `dc` = Domain Component
  - On crÃ©e un domaine virtuel "techservices.local"

**4. Configuration du serveur LDAP**

- **Port d'Ã©coute LDAP** : `389` (port standard)
- **Activer LDAPS (SSL)** : âŒ Laisser dÃ©cochÃ© pour l'instant (simplification)
- **Autoriser les connexions anonymes** : âŒ Non (sÃ©curitÃ©)

**5. Appliquer la configuration**

Cliquer sur `Appliquer` en bas de la page.

:::tip[Validation Ã‰tape 2.1]
- âœ… Message de confirmation : "L'annuaire LDAP interne est activÃ©"
- âœ… Capture d'Ã©cran : Page de configuration de l'annuaire avec LDAP activÃ©
:::

---

## Ã‰tape 2.2 : CrÃ©ation d'une UnitÃ© Organisationnelle (OU)

### ğŸ¯ Objectif
Organiser les utilisateurs dans une structure logique (comme des dossiers).

### ğŸ”§ TÃ¢che : CrÃ©er une OU pour les utilisateurs VPN

**1. AccÃ©der Ã  la gestion de l'annuaire**

```
Configuration â†’ Utilisateurs â†’ Annuaire â†’ Onglet "Gestion de l'annuaire"
```

Vous voyez une arborescence avec la base : `dc=techservices,dc=local`

**2. CrÃ©er une UnitÃ© Organisationnelle**

- Clic droit sur `dc=techservices,dc=local`
- SÃ©lectionner : `Ajouter une unitÃ© organisationnelle`

ParamÃ¨tres :
- **Nom de l'OU** : `utilisateurs_vpn`
- **Description** : `Utilisateurs autorisÃ©s Ã  se connecter au VPN SSL`

**3. CrÃ©er**

Cliquer sur `CrÃ©er`.

Vous devez maintenant voir dans l'arborescence :
```
dc=techservices,dc=local
  â””â”€â”€ ou=utilisateurs_vpn
```

:::tip[Qu'est-ce qu'une OU ?]
Une **UnitÃ© Organisationnelle** (_Organizational Unit_) est un conteneur logique qui permet d'organiser les objets (utilisateurs, groupes) dans l'annuaire.
C'est comme crÃ©er un dossier pour ranger des fichiers.
:::

:::tip[Validation Ã‰tape 2.2]
- âœ… L'OU `utilisateurs_vpn` apparaÃ®t dans l'arborescence
- âœ… Capture d'Ã©cran : Arborescence LDAP avec l'OU crÃ©Ã©e
:::

---

## Ã‰tape 2.3 : CrÃ©ation des utilisateurs

### ğŸ¯ Objectif
CrÃ©er les comptes utilisateurs qui pourront se connecter au VPN.

### Contexte mÃ©tier : Utilisateurs Ã  crÃ©er

Pour l'entreprise **TechServices SARL**, crÃ©ons les comptes suivants :

| Nom complet   | Login   | Service           | RÃ´le                  |
| ------------- | ------- | ----------------- | --------------------- |
| Jean Dupont   | jdupont | Commercial Lyon   | AccÃ¨s VPN agence      |
| Marie Martin  | mmartin | Commercial Lyon   | AccÃ¨s VPN agence      |
| Pierre Durand | pdurand | Support technique | AccÃ¨s VPN tÃ©lÃ©travail |

### ğŸ”§ TÃ¢che : CrÃ©er l'utilisateur Jean Dupont

**1. AccÃ©der Ã  la crÃ©ation d'utilisateur**

- Dans l'arborescence LDAP, clic droit sur `ou=utilisateurs_vpn`
- SÃ©lectionner : `Ajouter un utilisateur`

**2. Remplir les informations utilisateur**

**Onglet IdentitÃ© :**
- **Login** : `jdupont`
- **Nom** : `Dupont`
- **PrÃ©nom** : `Jean`
- **Nom complet** (CN) : `Jean Dupont` (calculÃ© automatiquement)
- **Description** : `Commercial - Agence Lyon`
- **E-mail** : `jdupont@techservices.local`

**Onglet Authentification :**
- **Mot de passe** : `Vpn2025!`
- **Confirmer le mot de passe** : `Vpn2025!`
- **Forcer le changement au prochain login** : âŒ DÃ©cocher (pour simplifier les tests)
- **Le mot de passe n'expire jamais** : âœ… Cocher (pour cette activitÃ©)
- **Compte activÃ©** : âœ… Cocher

**Onglet Appartenance aux groupes :**
- Laisser vide pour l'instant (on crÃ©era les groupes aprÃ¨s)

**3. CrÃ©er l'utilisateur**

Cliquer sur `CrÃ©er`.

L'utilisateur apparaÃ®t maintenant dans l'arborescence :
```
dc=techservices,dc=local
  â””â”€â”€ ou=utilisateurs_vpn
        â””â”€â”€ cn=Jean Dupont (jdupont)
```

### ğŸ”§ TÃ¢che : CrÃ©er les utilisateurs suivants

RÃ©pÃ©tez la procÃ©dure pour crÃ©er :

**Utilisateur 2 - Marie Martin :**
- **Login** : `mmartin`
- **Nom** : `Martin`
- **PrÃ©nom** : `Marie`
- **Description** : `Commercial - Agence Lyon`
- **E-mail** : `mmartin@techservices.local`
- **Mot de passe** : `Vpn2025!`

**Utilisateur 3 - Pierre Durand :**
- **Login** : `pdurand`
- **Nom** : `Durand`
- **PrÃ©nom** : `Pierre`
- **Description** : `Support technique - TÃ©lÃ©travail`
- **E-mail** : `pdurand@techservices.local`
- **Mot de passe** : `Vpn2025!`

:::tip[Validation Ã‰tape 2.3]
- âœ… Les 3 utilisateurs apparaissent dans l'arborescence sous `ou=utilisateurs_vpn`
- âœ… Capture d'Ã©cran : Arborescence LDAP complÃ¨te avec les 3 utilisateurs
- âœ… Capture d'Ã©cran : Fiche dÃ©taillÃ©e d'un utilisateur (ex: Jean Dupont)
:::

---

## Ã‰tape 2.4 : CrÃ©ation de groupes d'utilisateurs

### ğŸ¯ Objectif
Organiser les utilisateurs en groupes pour faciliter la gestion des droits d'accÃ¨s.

### ğŸ”§ TÃ¢che : CrÃ©er un groupe "Utilisateurs VPN"

**1. CrÃ©er une OU pour les groupes**

- Clic droit sur `dc=techservices,dc=local`
- `Ajouter une unitÃ© organisationnelle`
- **Nom** : `groupes`
- **Description** : `Groupes d'utilisateurs`
- CrÃ©er

**2. CrÃ©er le groupe**

- Clic droit sur `ou=groupes`
- SÃ©lectionner : `Ajouter un groupe`

ParamÃ¨tres :
- **Nom du groupe (CN)** : `Utilisateurs_VPN`
- **Description** : `Groupe des utilisateurs autorisÃ©s Ã  se connecter au VPN SSL`
- **Type de groupe** : `Groupe de sÃ©curitÃ©` (par dÃ©faut)

**3. Ajouter des membres au groupe**

**Onglet Membres :**
- Cliquer sur `Ajouter`
- Dans la fenÃªtre de recherche, chercher et sÃ©lectionner :
  - âœ… `Jean Dupont (jdupont)`
  - âœ… `Marie Martin (mmartin)`
  - âœ… `Pierre Durand (pdurand)`
- Valider

**4. CrÃ©er le groupe**

Cliquer sur `CrÃ©er`.

Votre arborescence LDAP complÃ¨te :
```
dc=techservices,dc=local
  â”œâ”€â”€ ou=utilisateurs_vpn
  â”‚     â”œâ”€â”€ cn=Jean Dupont (jdupont)
  â”‚     â”œâ”€â”€ cn=Marie Martin (mmartin)
  â”‚     â””â”€â”€ cn=Pierre Durand (pdurand)
  â””â”€â”€ ou=groupes
        â””â”€â”€ cn=Utilisateurs_VPN (3 membres)
```

:::tip[Pourquoi crÃ©er des groupes ?]
Les groupes permettent de :
- **Simplifier la gestion** : au lieu d'autoriser 3 utilisateurs un par un, on autorise le groupe
- **Faciliter l'Ã©volution** : ajouter un nouvel utilisateur = juste l'ajouter au groupe
- **Appliquer des politiques** : des rÃ¨gles diffÃ©rentes selon les groupes (VPN, Admin, InvitÃ©s, etc.)
:::

:::tip[Validation Ã‰tape 2.4]
- âœ… Le groupe `Utilisateurs_VPN` apparaÃ®t dans `ou=groupes`
- âœ… Le groupe contient 3 membres
- âœ… Capture d'Ã©cran : Fiche du groupe montrant les 3 membres
:::

---

## Ã‰tape 2.5 : Test de l'authentification LDAP

### ğŸ¯ Objectif
VÃ©rifier que l'annuaire LDAP fonctionne correctement avant de configurer le VPN.

### ğŸ”§ TÃ¢che : Tester l'authentification via l'outil de diagnostic

**1. AccÃ©der Ã  l'outil de test**

```
Configuration â†’ Utilisateurs â†’ Annuaire â†’ Onglet "Test d'authentification"
```

**2. Tester l'authentification d'un utilisateur**

ParamÃ¨tres de test :
- **MÃ©thode d'authentification** : `Annuaire interne`
- **Nom d'utilisateur** : `jdupont`
- **Mot de passe** : `Vpn2025!`

Cliquer sur `Tester`.

**RÃ©sultat attendu :**
```
âœ… Authentification rÃ©ussie
Utilisateur : cn=Jean Dupont,ou=utilisateurs_vpn,dc=techservices,dc=local
Groupes : cn=Utilisateurs_VPN,ou=groupes,dc=techservices,dc=local
```

**3. Tester les autres utilisateurs**

RÃ©pÃ©ter le test avec :
- `mmartin` / `Vpn2025!` â†’ âœ… Doit rÃ©ussir
- `pdurand` / `Vpn2025!` â†’ âœ… Doit rÃ©ussir
- `jdupont` / `MauvaisMotDePasse` â†’ âŒ Doit Ã©chouer

:::tip[Validation Ã‰tape 2.5]
- âœ… Les 3 utilisateurs s'authentifient avec succÃ¨s
- âœ… Un mauvais mot de passe est refusÃ©
- âœ… Capture d'Ã©cran : RÃ©sultat du test d'authentification rÃ©ussi pour jdupont
:::

---

## Ã‰tape 2.6 : Configuration du portail captif (optionnel mais recommandÃ©)

### ğŸ¯ Objectif
Activer le portail captif pour tester l'authentification web des utilisateurs.

:::note[Portail captif]
Un **portail captif** est une page web qui demande l'authentification avant d'autoriser l'accÃ¨s au rÃ©seau.
C'est similaire au WiFi public des hÃ´tels ou aÃ©roports.
:::

### ğŸ”§ TÃ¢che : Activer le portail captif sur l'interface IN

**1. AccÃ©der Ã  la configuration du portail captif**

```
Configuration â†’ Utilisateurs â†’ Authentification â†’ Portail captif
```

**2. Configurer le portail captif**

**Onglet GÃ©nÃ©ral :**
- **Activer le portail captif** : âœ… Cocher
- **Type de portail** : `Standard` (page de login simple)
- **MÃ©thode d'authentification** : `Annuaire LDAP interne`

**Onglet Interfaces :**
- **Interfaces activÃ©es** :
  - âœ… Cocher `in` (interface rÃ©seau interne)
  - âŒ DÃ©cocher `out` (pas d'authentification sur Internet)

**Onglet Redirection :**
- **URL de redirection aprÃ¨s authentification** : `http://10.Y.1.20` (votre serveur web)
- Laisser les autres paramÃ¨tres par dÃ©faut

**3. Appliquer**

Cliquer sur `Appliquer`.

### ğŸ”§ TÃ¢che : Tester le portail captif

**1. Depuis le serveur Debian (ou crÃ©er une VM cliente temporaire sur le rÃ©seau interne)**

Ouvrir un navigateur web et tenter d'accÃ©der Ã  n'importe quel site :
```
http://www.google.com
```

**2. Vous devez Ãªtre redirigÃ© vers le portail captif**

Page d'authentification du SNS :
- **Nom d'utilisateur** : `jdupont`
- **Mot de passe** : `Vpn2025!`
- Se connecter

**3. AprÃ¨s authentification**

Vous Ãªtes redirigÃ© vers `http://10.Y.1.20` (votre serveur web Debian).

:::tip[Si le portail captif ne s'affiche pas]
VÃ©rifiez que :
- Le portail est bien activÃ© sur l'interface `in`
- Les rÃ¨gles de filtrage autorisent l'accÃ¨s au port 443 du firewall
- Le serveur Debian a bien le SNS comme gateway
:::

:::tip[Validation Ã‰tape 2.6]
- âœ… Le portail captif s'affiche lors de la navigation
- âœ… L'authentification avec jdupont fonctionne
- âœ… AprÃ¨s authentification, accÃ¨s au serveur web possible
- âœ… Capture d'Ã©cran : Page du portail captif
- âœ… Capture d'Ã©cran : Page web du serveur Debian aprÃ¨s authentification
:::

---

## Ã‰tape 2.7 : VÃ©rification des logs d'authentification

### ğŸ”§ TÃ¢che : Consulter les Ã©vÃ©nements d'authentification

**1. AccÃ©der aux logs d'authentification**

```
Monitoring â†’ Logs â†’ Utilisateurs â†’ Authentifications
```

**2. Observer les Ã©vÃ©nements**

Vous devriez voir :
- Les tentatives de connexion (rÃ©ussies et Ã©chouÃ©es)
- L'utilisateur concernÃ© (jdupont, mmartin, etc.)
- La date et l'heure
- La mÃ©thode (LDAP interne)
- Le statut (Success / Failed)

**3. Analyser un Ã©chec d'authentification**

Tentez de vous connecter avec un mauvais mot de passe et observez :
- âŒ Ligne rouge dans les logs
- Message : "Authentication failed"
- Raison : "Invalid credentials"

:::tip[Validation Ã‰tape 2.7]
- âœ… Les logs d'authentification sont visibles
- âœ… Les authentifications rÃ©ussies apparaissent en vert
- âœ… Les Ã©checs apparaissent en rouge
- âœ… Capture d'Ã©cran : Logs d'authentification montrant une connexion rÃ©ussie
:::

---

## âœ… Tableau de validation de la Phase 2

ComplÃ©tez ce tableau dans votre compte-rendu :

| TÃ¢che                             | DÃ©tails                            | âœ…/âŒ |
| --------------------------------- | ---------------------------------- | ----- |
| Activation LDAP interne           | Base DN : dc=techservices,dc=local |       |
| CrÃ©ation OU utilisateurs_vpn      | Visible dans l'arborescence        |       |
| CrÃ©ation utilisateur jdupont      | Login fonctionnel                  |       |
| CrÃ©ation utilisateur mmartin      | Login fonctionnel                  |       |
| CrÃ©ation utilisateur pdurand      | Login fonctionnel                  |       |
| CrÃ©ation OU groupes               | Visible dans l'arborescence        |       |
| CrÃ©ation groupe Utilisateurs_VPN  | 3 membres                          |       |
| Test d'authentification jdupont   | SuccÃ¨s                             |       |
| Test d'authentification mmartin   | SuccÃ¨s                             |       |
| Test mauvais mot de passe         | Ã‰chec (normal)                     |       |
| Portail captif activÃ© (optionnel) | Fonctionne sur interface in        |       |
| Logs d'authentification visibles  | Ã‰vÃ©nements affichÃ©s                |       |

---

## âœ… CritÃ¨res de validation de la Phase 2

Avant de passer Ã  la Phase 3, assurez-vous que :

- [ ] L'annuaire LDAP interne est activÃ©
- [ ] L'arborescence LDAP est correctement structurÃ©e (OU + utilisateurs + groupes)
- [ ] Les 3 utilisateurs sont crÃ©Ã©s avec les bons mots de passe
- [ ] Le groupe `Utilisateurs_VPN` contient les 3 membres
- [ ] Les tests d'authentification dans l'outil de diagnostic rÃ©ussissent
- [ ] Les logs d'authentification sont consultables
- [ ] (Optionnel) Le portail captif fonctionne sur l'interface interne

:::tip[Checkpoint enseignant]
ğŸ‘¨â€ğŸ« Avant de continuer, faites valider votre configuration par l'enseignant.
Montrez-lui :
1. L'arborescence LDAP complÃ¨te
2. La fiche d'un utilisateur
3. La fiche du groupe avec ses membres
4. Un test d'authentification rÃ©ussi
5. Les logs d'authentification
:::

---

## ğŸ¯ RÃ©sumÃ© de la Phase 2

Vous avez maintenant :

- âœ… Un annuaire LDAP interne opÃ©rationnel
- âœ… Une structure organisationnelle claire (OU pour utilisateurs et groupes)
- âœ… 3 utilisateurs crÃ©Ã©s et testÃ©s
- âœ… 1 groupe de sÃ©curitÃ© contenant ces utilisateurs
- âœ… Un systÃ¨me d'authentification fonctionnel
- âœ… Des logs pour tracer les connexions

**Infrastructure d'authentification prÃªte pour le VPN SSL !**

**Prochaine Ã©tape** : Phase 3 - Configuration du serveur VPN SSL sur le Stormshield

---

## ğŸ“š Pour aller plus loin (bonus)

Si vous avez terminÃ© en avance, vous pouvez :

### Bonus 1 : CrÃ©er un deuxiÃ¨me groupe avec des droits diffÃ©rents

CrÃ©ez un groupe `Administrateurs_VPN` avec :
- Un utilisateur `admin_vpn`
- Qui aura des droits d'administration sur le VPN (on verra Ã§a en Phase 4)

### Bonus 2 : Tester l'authentification depuis la ligne de commande

Depuis votre machine hÃ´te, installez `ldapsearch` :
```bash
sudo apt install ldap-utils
```

Testez une requÃªte LDAP :
```bash
ldapsearch -x -H ldap://172.25.Y.254:389 \
  -D "cn=Jean Dupont,ou=utilisateurs_vpn,dc=techservices,dc=local" \
  -w "Vpn2025!" \
  -b "dc=techservices,dc=local" "(objectClass=*)"
```

Vous devriez voir l'arborescence LDAP complÃ¨te.

### Bonus 3 : Comprendre le format DN (Distinguished Name)

Analysez le DN complet d'un utilisateur :
```
cn=Jean Dupont,ou=utilisateurs_vpn,dc=techservices,dc=local
```

DÃ©composition :
- `cn` = Common Name (nom complet de l'utilisateur)
- `ou` = Organizational Unit (unitÃ© organisationnelle)
- `dc` = Domain Component (composant du domaine)

C'est comme un chemin de fichier, mais lu de droite Ã  gauche :
```
techservices.local / utilisateurs_vpn / Jean Dupont
```
