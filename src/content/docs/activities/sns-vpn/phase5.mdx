---
title: "Phase 5 - Installation du client VPN et connexion"
description: "Installation et configuration du client OpenVPN Connect, connexion au VPN SSL et validation du fonctionnement"
---

# Phase 5 : Installation du client VPN et connexion

## Informations

- **DurÃ©e estimÃ©e** : 1h30
- **PrÃ©requis** : Phases 1, 2, 3 et 4 terminÃ©es et validÃ©es
- **RÃ´le principal** : Ã‰tudiant X (Client VPN)
- **Participation** : Ã‰tudiant Y (support)

---

## Objectifs de cette phase

- âœ… Comprendre le rÃ´le du client VPN
- âœ… TÃ©lÃ©charger et installer OpenVPN Connect
- âœ… RÃ©cupÃ©rer le profil de connexion depuis le portail
- âœ… Configurer le client VPN avec le profil
- âœ… Se connecter au VPN SSL
- âœ… VÃ©rifier l'attribution d'une IP virtuelle
- âœ… Tester l'accÃ¨s aux ressources internes via le VPN
- âœ… Analyser les logs de connexion VPN

---

## Contexte : Le client VPN

### Qu'est-ce qu'un client VPN ?

Un **client VPN** est un logiciel installÃ© sur l'ordinateur de l'utilisateur qui permet de :
- ğŸ” Ã‰tablir un tunnel sÃ©curisÃ© (chiffrÃ©) vers le serveur VPN
- ğŸŒ Obtenir une adresse IP virtuelle sur le rÃ©seau distant
- ğŸ“¡ Router le trafic Ã  travers le tunnel VPN
- ğŸ”‘ S'authentifier auprÃ¨s du serveur VPN

### Pourquoi OpenVPN Connect ?

**OpenVPN** est le protocole VPN open-source le plus utilisÃ© :
- âœ… Compatible avec Stormshield (le SNS utilise OpenVPN pour le VPN SSL)
- âœ… Multi-plateforme (Windows, Linux, macOS, Android, iOS)
- âœ… Open-source et auditÃ©
- âœ… TrÃ¨s sÃ©curisÃ© (chiffrement AES-256)

**OpenVPN Connect** est le client officiel dÃ©veloppÃ© par OpenVPN Inc.

### Architecture de connexion

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     AVANT LA CONNEXION VPN                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  Client VPN (172.25.X.10)                                    â”‚
â”‚       â”‚                                                      â”‚
â”‚       â”‚ AccÃ¨s uniquement au rÃ©seau LABO                      â”‚
â”‚       â–¼                                                      â”‚
â”‚  Internet (LABO 172.25.0.0/16)                               â”‚
â”‚       â”‚                                                      â”‚
â”‚       âœ— Pas d'accÃ¨s au rÃ©seau interne (10.Y.1.0/24)          â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     APRÃˆS LA CONNEXION VPN                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  Client VPN                                                  â”‚
â”‚  â”œâ”€ IP physique : 172.25.X.10 (reste inchangÃ©e)              â”‚
â”‚  â””â”€ IP virtuelle VPN : 10.Y.100.5 (nouvelle !)               â”‚
â”‚       â”‚                                                      â”‚
â”‚       â”‚ Tunnel SSL/TLS chiffrÃ©                               â”‚
â”‚       â–¼                                                      â”‚
â”‚  Serveur VPN (172.25.Y.254)                                  â”‚
â”‚       â”‚                                                      â”‚
â”‚       â”‚ Le serveur route vers le rÃ©seau interne              â”‚
â”‚       â–¼                                                      â”‚
â”‚  RÃ©seau interne (10.Y.1.0/24)                                â”‚
â”‚       â””â”€ Serveur Debian : 10.Y.1.20 âœ… Accessible !          â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Ã‰tape 5.1 : Installation d'OpenVPN Connect

:::caution[RÃ´le principal]
**Cette phase est rÃ©alisÃ©e par l'Ã‰tudiant X** (Client VPN).
L'Ã‰tudiant Y peut observer ou aider en cas de problÃ¨me.
:::

### ğŸ”§ TÃ¢che : Installer OpenVPN Connect sur la VM Client

**1. Se connecter Ã  la VM Client VPN (XUbuntu)**

- Login : `sysadmin`
- Mot de passe : `netlab123`

**2. Ouvrir un terminal**

**3. TÃ©lÃ©charger et installer OpenVPN Connect**

Pour Linux (XUbuntu), plusieurs options :

**Option A : Installation via le dÃ©pÃ´t OpenVPN (recommandÃ©)**

```bash
# TÃ©lÃ©charger la clÃ© GPG du dÃ©pÃ´t OpenVPN
sudo mkdir -p /etc/apt/keyrings
curl -fsSL https://swupdate.openvpn.net/repos/openvpn-repo-pkg-key.pub | sudo gpg --dearmor -o /etc/apt/keyrings/openvpn-repo.gpg

# Ajouter le dÃ©pÃ´t OpenVPN
echo "deb [signed-by=/etc/apt/keyrings/openvpn-repo.gpg] https://swupdate.openvpn.net/community/openvpn3/repos/ubuntu jammy main" | sudo tee /etc/apt/sources.list.d/openvpn3.list

# Mettre Ã  jour et installer
sudo apt update
sudo apt install -y openvpn3
```

**Option B : Installation du client classique (alternative)**

```bash
# Plus simple mais interface en ligne de commande uniquement
sudo apt update
sudo apt install -y openvpn network-manager-openvpn network-manager-openvpn-gnome
```

**4. VÃ©rifier l'installation**

```bash
# Pour OpenVPN3
openvpn3 version

# Pour OpenVPN classique
openvpn --version
```

**RÃ©sultat attendu :**
```
OpenVPN 3 Linux ...
```
ou
```
OpenVPN 2.x.x ...
```

:::tip[OpenVPN3 vs OpenVPN classique]
- **OpenVPN3** : Version moderne, meilleure intÃ©gration systÃ¨me, interface graphique
- **OpenVPN classique** : Version historique, plus simple, ligne de commande

Les deux fonctionnent avec Stormshield. Pour cette activitÃ©, **OpenVPN3** est recommandÃ©.
:::

:::tip[Validation Ã‰tape 5.1]
- âœ… OpenVPN est installÃ©
- âœ… La commande `openvpn3 version` ou `openvpn --version` fonctionne
- âœ… Capture d'Ã©cran : RÃ©sultat de la commande version
:::

---

## Ã‰tape 5.2 : TÃ©lÃ©chargement du profil de connexion VPN

### ğŸ¯ Objectif
RÃ©cupÃ©rer le fichier de configuration `.ovpn` depuis le portail web du SNS.

### ğŸ”§ TÃ¢che : AccÃ©der au portail web et tÃ©lÃ©charger le profil

**1. Ouvrir un navigateur web sur la VM Client**

**2. AccÃ©der au portail VPN**

```
URL : https://172.25.Y.254/
```
(Remplacer Y par le numÃ©ro de l'Ã‰tudiant Serveur)

**3. Accepter le certificat auto-signÃ©**

- Cliquer sur `AvancÃ©` ou `ParamÃ¨tres avancÃ©s`
- `Accepter le risque et continuer`

**4. Page d'accueil du portail**

Vous devriez voir :
- ğŸ” Formulaire de connexion
- ğŸ“¥ Lien : **"TÃ©lÃ©charger le profil de connexion"** ou **"Download VPN Profile"**

**5. TÃ©lÃ©charger le profil de connexion**

:::note[Deux mÃ©thodes possibles]
Selon la configuration du SNS, vous pouvez tÃ©lÃ©charger le profil :

**MÃ©thode 1 : Sans authentification (accÃ¨s public au profil)**
- Cliquer directement sur "TÃ©lÃ©charger le profil"
- Le fichier `vpn-techservices.ovpn` se tÃ©lÃ©charge

**MÃ©thode 2 : Avec authentification (plus sÃ©curisÃ©)**
- Cliquer sur "TÃ©lÃ©charger le profil"
- Page de login apparaÃ®t
- Se connecter avec `jdupont` / `Vpn2025!`
- Le profil se tÃ©lÃ©charge aprÃ¨s authentification
:::

**6. Sauvegarder le fichier**

Le fichier tÃ©lÃ©chargÃ© s'appelle gÃ©nÃ©ralement :
- `client.ovpn`
- `vpn-ssl.ovpn`
- `vpn-techservices.ovpn`

Sauvegarder dans : `/home/client/TÃ©lÃ©chargements/`

:::tip[Qu'est-ce qu'un fichier .ovpn ?]
Un fichier `.ovpn` (OpenVPN) contient toute la configuration nÃ©cessaire pour se connecter au VPN :
- Adresse du serveur VPN (172.25.Y.254)
- Port (443)
- Protocole (TCP ou UDP)
- Certificats (CA, client)
- Options de chiffrement (AES-256, SHA256)
- Routes Ã  ajouter (10.Y.1.0/24)

C'est comme un "paquet tout-en-un" pour la connexion VPN.
:::

:::tip[Validation Ã‰tape 5.2]
- âœ… Le portail web est accessible
- âœ… Le fichier `.ovpn` est tÃ©lÃ©chargÃ©
- âœ… Le fichier est dans `/home/client/TÃ©lÃ©chargements/`
- âœ… Capture d'Ã©cran : Portail web avec lien de tÃ©lÃ©chargement visible
:::

---

## Ã‰tape 5.3 : Analyse du profil de connexion (optionnel mais pÃ©dagogique)

### ğŸ”§ TÃ¢che : Examiner le contenu du fichier .ovpn

**1. Ouvrir le fichier avec un Ã©diteur de texte**

```bash
cd ~/TÃ©lÃ©chargements
cat *.ovpn | less
# ou
nano *.ovpn
```

**2. Observer les directives importantes**

Vous devriez voir quelque chose comme :

```
# Configuration client OpenVPN pour TechServices VPN
client
dev tun
proto tcp
remote 172.25.Y.254 443
resolv-retry infinite
nobind
persist-key
persist-tun

# SÃ©curitÃ©
remote-cert-tls server
cipher AES-256-GCM
auth SHA256
key-direction 1

# Certificat de l'autoritÃ© de certification (CA)
<ca>
-----BEGIN CERTIFICATE-----
MIIDXzCCAkegAwIBAgIJAK... (contenu du certificat)
-----END CERTIFICATE-----
</ca>

# Certificat client (si authentification par certificat)
<cert>
-----BEGIN CERTIFICATE-----
MIIDXzCCAkegAwIBAgIJAK...
-----END CERTIFICATE-----
</cert>

# ClÃ© privÃ©e client (si authentification par certificat)
<key>
-----BEGIN PRIVATE KEY-----
MIIEvgIBADANBgkqhkiG9w...
-----END PRIVATE KEY-----
</key>

# Routes Ã  ajouter aprÃ¨s connexion
route 10.Y.1.0 255.255.255.0
```

**3. Comprendre les directives clÃ©s**

| Directive | Signification |
|-----------|---------------|
| `client` | Ce fichier configure un client (pas un serveur) |
| `dev tun` | Utiliser une interface TUN (tunnel rÃ©seau de niveau 3) |
| `proto tcp` | Utiliser TCP (ou UDP selon config) |
| `remote 172.25.Y.254 443` | Adresse et port du serveur VPN |
| `cipher AES-256-GCM` | Algorithme de chiffrement (trÃ¨s sÃ©curisÃ©) |
| `auth SHA256` | Algorithme d'authentification des paquets |
| `route 10.Y.1.0 ...` | Route vers le rÃ©seau interne (split tunnel) |

:::tip[Ne pas modifier le fichier]
Ce fichier a Ã©tÃ© gÃ©nÃ©rÃ© automatiquement par le SNS avec les bons paramÃ¨tres.
**Ne le modifiez pas** sauf si vous savez exactement ce que vous faites.
:::

:::tip[Validation Ã‰tape 5.3]
- âœ… Le fichier `.ovpn` contient les paramÃ¨tres de connexion
- âœ… L'adresse du serveur (172.25.Y.254:443) est correcte
- âœ… Les certificats sont inclus dans le fichier
- âœ… Capture d'Ã©cran : Extrait du fichier .ovpn montrant les paramÃ¨tres principaux
:::

---

## Ã‰tape 5.4 : Connexion au VPN avec OpenVPN3

### ğŸ¯ Objectif
Ã‰tablir la connexion VPN et obtenir une IP virtuelle.

### ğŸ”§ TÃ¢che : Se connecter au VPN

**1. Importer le profil dans OpenVPN3**

```bash
cd ~/TÃ©lÃ©chargements

# Importer le profil (remplacer le nom du fichier si nÃ©cessaire)
openvpn3 config-import --config client.ovpn --name VPN-TechServices --persistent
```

**RÃ©sultat attendu :**
```
Configuration imported.  Configuration path: /net/openvpn/v3/configuration/xxxxx
```

**2. Lister les profils importÃ©s**

```bash
openvpn3 configs-list
```

**RÃ©sultat attendu :**
```
Configuration path: /net/openvpn/v3/configuration/xxxxx
    Name: VPN-TechServices
    Read only: False
```

**3. Se connecter au VPN**

```bash
openvpn3 session-start --config VPN-TechServices
```

**Une invite de connexion apparaÃ®t :**

```
Enter Authentication Username: jdupont
Enter Authentication Password:
```

**Entrer les identifiants :**
- **Username** : `jdupont`
- **Password** : `Vpn2025!`

**4. Observer la connexion en cours**

Vous devriez voir des messages de log :

```
Connecting to [172.25.Y.254]:443 (tcp) via out
WAIT: Connecting
Tunnel device 'tun0' opened
CONNECTED
```

:::caution[Si l'authentification Ã©choue]
VÃ©rifiez que :
- Le login/mot de passe sont corrects (jdupont / Vpn2025!)
- L'utilisateur existe bien dans l'annuaire LDAP (Phase 2)
- L'utilisateur fait partie du groupe `Utilisateurs_VPN` (Phase 2)
- La politique d'accÃ¨s VPN autorise ce groupe (Phase 3)

Consultez les logs sur le SNS :
```
Monitoring â†’ Logs â†’ VPN â†’ VPN SSL
```
:::

**5. VÃ©rifier l'Ã©tat de la connexion**

```bash
openvpn3 sessions-list
```

**RÃ©sultat attendu :**
```
Session path: /net/openvpn/v3/sessions/xxxxx
    Status: Connection, Client connected
    Config name: VPN-TechServices
    Device: tun0
    Client address: 10.Y.100.5  â† IP virtuelle attribuÃ©e !
    VPN remote: 172.25.Y.254:443
```

:::tip[ğŸ‰ Connexion rÃ©ussie !]
Si vous voyez **"Client connected"** et une **IP virtuelle (10.Y.100.x)**, fÃ©licitations !
Le tunnel VPN est Ã©tabli. ğŸ”
:::

:::tip[Validation Ã‰tape 5.4]
- âœ… Le profil est importÃ© dans OpenVPN3
- âœ… La connexion VPN est Ã©tablie (status: "Connected")
- âœ… Une IP virtuelle est attribuÃ©e (10.Y.100.x)
- âœ… L'interface `tun0` est crÃ©Ã©e
- âœ… Capture d'Ã©cran : RÃ©sultat de `openvpn3 sessions-list` montrant la connexion active
:::

---

## Ã‰tape 5.5 : VÃ©rification de la configuration rÃ©seau avec le VPN

### ğŸ”§ TÃ¢che : Analyser les changements rÃ©seau

**1. VÃ©rifier les interfaces rÃ©seau**

```bash
ip a
```

**Observer les interfaces :**

```
1: lo: <LOOPBACK,UP,LOWER_UP> ...
    inet 127.0.0.1/8 ...

2: enp0s3: <BROADCAST,MULTICAST,UP,LOWER_UP> ...
    inet 172.25.X.10/16 ...          â† IP physique (inchangÃ©e)

3: tun0: <POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP> ...
    inet 10.Y.100.5/32 ...            â† IP virtuelle VPN (nouvelle !)
```

**2. VÃ©rifier la table de routage**

```bash
ip route
```

**Observer les routes :**

```
default via 172.25.254.254 dev enp0s3           â† Route par dÃ©faut (Internet)
10.Y.1.0/24 via 10.Y.100.1 dev tun0             â† Route vers rÃ©seau interne via VPN !
10.Y.100.1 dev tun0 proto kernel scope link     â† Route locale VPN
172.25.0.0/16 dev enp0s3 proto kernel scope link â† RÃ©seau LABO
```

**Analyse :**
- âœ… Route par dÃ©faut : reste sur `enp0s3` (Internet direct) â†’ **Split tunneling**
- âœ… Route vers `10.Y.1.0/24` : passe par `tun0` (VPN) â†’ **Trafic interne via VPN**
- âœ… Route locale VPN : `10.Y.100.1` (passerelle VPN)

:::tip[Split Tunneling en action]
GrÃ¢ce au split tunneling (configurÃ© en Phase 3) :
- Trafic vers `10.Y.1.0/24` â†’ ğŸ” Passe par le VPN
- Trafic vers Internet â†’ ğŸŒ Passe directement (plus rapide)

C'est visible dans la table de routage !
:::

**3. Tester la connectivitÃ© VPN**

```bash
# Test vers la passerelle VPN
ping -c 4 10.Y.100.1

# Test vers l'interface IN du SNS
ping -c 4 10.Y.1.254

# Test vers le serveur Debian (ressource interne)
ping -c 4 10.Y.1.20
```

**RÃ©sultats attendus :**
- âœ… Ping vers 10.Y.100.1 : OK (passerelle VPN)
- âœ… Ping vers 10.Y.1.254 : OK (SNS interface IN)
- âœ… Ping vers 10.Y.1.20 : OK (serveur Debian) â†’ **ğŸ‰ C'EST LE BUT DU VPN !**

:::caution[Si les pings Ã©chouent]
VÃ©rifiez que :
- La connexion VPN est bien active (`openvpn3 sessions-list`)
- Les routes sont correctes (`ip route`)
- Les rÃ¨gles de filtrage (Phase 4) sont bien configurÃ©es
- Le serveur Debian a bien 10.Y.1.254 comme gateway

Consultez les logs du SNS :
```
Monitoring â†’ Logs â†’ Filtrage et NAT â†’ Connexions
Filtrer par : Source = 10.Y.100.x
```
:::

:::tip[Validation Ã‰tape 5.5]
- âœ… L'interface `tun0` est crÃ©Ã©e avec IP 10.Y.100.x
- âœ… Les routes vers 10.Y.1.0/24 passent par le VPN
- âœ… Ping vers 10.Y.100.1 (gateway VPN) : OK
- âœ… Ping vers 10.Y.1.254 (SNS IN) : OK
- âœ… Ping vers 10.Y.1.20 (serveur Debian) : OK â† **Objectif atteint !**
- âœ… Capture d'Ã©cran : RÃ©sultats des pings rÃ©ussis
- âœ… Capture d'Ã©cran : Table de routage montrant les routes VPN
:::

---

## Ã‰tape 5.6 : Tests d'accÃ¨s aux ressources internes

### ğŸ¯ Objectif
VÃ©rifier l'accÃ¨s aux services du rÃ©seau interne via le VPN.

### ğŸ”§ TÃ¢che : Tester diffÃ©rents services

**1. Test HTTP vers le serveur web Debian**

```bash
# Test avec curl
curl http://10.Y.1.20

# Ou ouvrir dans un navigateur
firefox http://10.Y.1.20 &
```

**RÃ©sultat attendu :**
```html
<h1>Serveur TechServices - Ressource interne</h1>
<p>Si vous voyez cette page, le VPN fonctionne !</p>
```

**Dans le navigateur :** La page web du serveur Debian doit s'afficher.

**2. Test SSH vers le serveur Debian**

```bash
ssh techservices@10.Y.1.20
# Mot de passe : Sio2025!
```

**RÃ©sultat attendu :** Connexion SSH rÃ©ussie !

```
Welcome to Debian GNU/Linux 12 (bookworm)
techservices@serveur-debian-Y:~$
```

**3. Test de transfert de fichier (SCP)**

```bash
# CrÃ©er un fichier de test
echo "Test VPN - Fichier envoyÃ© via le tunnel sÃ©curisÃ©" > test-vpn.txt

# Envoyer le fichier via SCP
scp test-vpn.txt techservices@10.Y.1.20:/tmp/

# VÃ©rifier la rÃ©ception
ssh techservices@10.Y.1.20 "cat /tmp/test-vpn.txt"
```

**RÃ©sultat attendu :**
```
Test VPN - Fichier envoyÃ© via le tunnel sÃ©curisÃ©
```

**4. Test de rÃ©solution DNS (si configurÃ©)**

```bash
# Si vous avez configurÃ© un DNS interne
nslookup serveur-debian-Y.techservices.local
```

:::tip[ğŸ‰ SuccÃ¨s complet !]
Si tous ces tests fonctionnent, le VPN est **pleinement opÃ©rationnel** !

Vous avez rÃ©ussi Ã  :
- âœ… Ã‰tablir un tunnel VPN SSL chiffrÃ©
- âœ… Obtenir une IP virtuelle sur le rÃ©seau distant
- âœ… AccÃ©der aux ressources internes (web, SSH, fichiers)
- âœ… Le tout de maniÃ¨re **sÃ©curisÃ©e** (chiffrement AES-256)

**FÃ©licitations ! ğŸŠ**
:::

:::tip[Validation Ã‰tape 5.6]
- âœ… Page web du serveur Debian accessible via le navigateur
- âœ… Connexion SSH vers 10.Y.1.20 rÃ©ussie
- âœ… Transfert de fichier SCP fonctionne
- âœ… Capture d'Ã©cran : Page web du serveur Debian dans le navigateur
- âœ… Capture d'Ã©cran : Session SSH active sur le serveur Debian
:::

---

## Ã‰tape 5.7 : Analyse des logs VPN cÃ´tÃ© serveur (Ã‰tudiant Y)

### ğŸ¯ Objectif
Observer les Ã©vÃ©nements de connexion VPN du cÃ´tÃ© serveur.

### ğŸ”§ TÃ¢che : Consulter les logs VPN sur le SNS (Ã‰tudiant Y)

**1. Se connecter Ã  l'interface web du SNS**

```
URL : https://172.25.Y.254/admin
Login : admin
```

**2. AccÃ©der aux logs VPN SSL**

```
Monitoring â†’ Logs â†’ VPN â†’ VPN SSL
```

**3. Observer les Ã©vÃ©nements**

Vous devriez voir des lignes montrant :

**Ã‰vÃ©nement 1 : Connexion initiale**
```
[INFO] User 'jdupont' connected from 172.25.X.10:xxxxx
[INFO] Assigned IP: 10.Y.100.5
[INFO] Routes pushed: 10.Y.1.0/24
```

**Ã‰vÃ©nement 2 : Authentification**
```
[INFO] LDAP authentication successful for user 'jdupont'
[INFO] User 'jdupont' member of group 'Utilisateurs_VPN'
[INFO] Policy 'Acces-VPN-Groupe-Utilisateurs' applied
```

**Ã‰vÃ©nement 3 : Ã‰tablissement du tunnel**
```
[INFO] TLS handshake completed
[INFO] Cipher: AES-256-GCM
[INFO] Tunnel established
[INFO] Session started for user 'jdupont'
```

**4. AccÃ©der aux logs de filtrage pour voir le trafic VPN**

```
Monitoring â†’ Logs â†’ Filtrage et NAT â†’ Connexions
```

**Filtrer par :**
- **Source** : `10.Y.100.5` (ou votre IP VPN)
- **Action** : `PASS`

**Vous devriez voir les connexions :**
```
Source: 10.Y.100.5  â†’  Dest: 10.Y.1.20  Service: HTTP   Action: PASS  Rule: VPN clients vers rÃ©seau interne
Source: 10.Y.100.5  â†’  Dest: 10.Y.1.20  Service: SSH    Action: PASS  Rule: VPN clients vers rÃ©seau interne
Source: 10.Y.1.20   â†’  Dest: 10.Y.100.5 Service: HTTP   Action: PASS  Rule: RÃ©seau interne vers clients VPN
```

:::tip[TraÃ§abilitÃ©]
Les logs montrent :
- **Qui** : jdupont
- **Quand** : Date et heure de connexion
- **D'oÃ¹** : 172.25.X.10 (IP origine)
- **IP attribuÃ©e** : 10.Y.100.5
- **AccÃ¨s** : Quelles ressources (10.Y.1.20) et quels services (HTTP, SSH)

C'est essentiel pour :
- La sÃ©curitÃ© (dÃ©tecter des accÃ¨s anormaux)
- L'audit (traÃ§abilitÃ© des actions)
- Le dÃ©pannage (identifier les problÃ¨mes)
:::

:::tip[Validation Ã‰tape 5.7]
- âœ… Les logs VPN montrent la connexion de jdupont
- âœ… L'IP attribuÃ©e (10.Y.100.5) est visible
- âœ… L'authentification LDAP est rÃ©ussie
- âœ… Les logs de filtrage montrent le trafic VPN autorisÃ©
- âœ… Capture d'Ã©cran : Logs VPN SSL montrant la connexion de jdupont
- âœ… Capture d'Ã©cran : Logs de filtrage montrant les connexions depuis 10.Y.100.5
:::

---

## Ã‰tape 5.8 : Test avec d'autres utilisateurs

### ğŸ¯ Objectif
VÃ©rifier que tous les utilisateurs crÃ©Ã©s en Phase 2 peuvent se connecter.

### ğŸ”§ TÃ¢che : Se connecter avec mmartin et pdurand

**1. Se dÃ©connecter du VPN (connexion actuelle)**

```bash
# Lister les sessions actives
openvpn3 sessions-list

# Se dÃ©connecter
openvpn3 session-manage --disconnect --config VPN-TechServices
```

**2. Se reconnecter avec mmartin**

```bash
openvpn3 session-start --config VPN-TechServices
```

**Identifiants :**
- **Username** : `mmartin`
- **Password** : `Vpn2025!`

**VÃ©rifier :**
```bash
openvpn3 sessions-list
# Observer l'IP attribuÃ©e (ex: 10.Y.100.6)

ping -c 4 10.Y.1.20
# Doit fonctionner
```

**3. Se dÃ©connecter et reconnecter avec pdurand**

```bash
openvpn3 session-manage --disconnect --config VPN-TechServices
openvpn3 session-start --config VPN-TechServices
```

**Identifiants :**
- **Username** : `pdurand`
- **Password** : `Vpn2025!`

**VÃ©rifier :**
```bash
openvpn3 sessions-list
ping -c 4 10.Y.1.20
```

**4. Observer les logs cÃ´tÃ© serveur (Ã‰tudiant Y)**

Sur le SNS, observer que :
- 3 utilisateurs diffÃ©rents se sont connectÃ©s
- Chacun a reÃ§u une IP diffÃ©rente du pool (10.Y.100.5, 10.Y.100.6, 10.Y.100.7)
- L'authentification LDAP a rÃ©ussi pour chacun

:::tip[Gestion du pool d'adresses]
Le SNS attribue dynamiquement les IP du pool :
- PremiÃ¨re connexion â†’ 10.Y.100.1 (ou .5)
- DeuxiÃ¨me connexion â†’ 10.Y.100.2 (ou .6)
- Etc.

Le pool peut gÃ©rer jusqu'Ã  62 clients simultanÃ©s (configuration Phase 3).
:::

:::tip[Validation Ã‰tape 5.8]
- âœ… mmartin peut se connecter au VPN
- âœ… pdurand peut se connecter au VPN
- âœ… Chaque utilisateur reÃ§oit une IP unique
- âœ… Tous peuvent accÃ©der au serveur Debian (10.Y.1.20)
- âœ… Les logs montrent les 3 connexions distinctes
- âœ… Capture d'Ã©cran : Logs VPN montrant les connexions de mmartin et pdurand
:::

---

## Ã‰tape 5.9 : Test de sÃ©curitÃ© - Utilisateur non autorisÃ©

### ğŸ¯ Objectif
VÃ©rifier que le systÃ¨me de sÃ©curitÃ© fonctionne en tentant une connexion avec un compte non autorisÃ©.

### ğŸ”§ TÃ¢che : Tenter de se connecter avec un utilisateur inexistant

**1. Se dÃ©connecter du VPN**

```bash
openvpn3 session-manage --disconnect --config VPN-TechServices
```

**2. Tenter une connexion avec de faux identifiants**

```bash
openvpn3 session-start --config VPN-TechServices
```

**Identifiants invalides :**
- **Username** : `hacker`
- **Password** : `password123`

**RÃ©sultat attendu :**
```
AUTH_FAILED: Authentication failed
Connection failed
```

**3. Observer les logs cÃ´tÃ© serveur**

Sur le SNS :
```
Monitoring â†’ Logs â†’ Utilisateurs â†’ Authentifications
```

Vous devriez voir :
```
âŒ [ERROR] Authentication failed for user 'hacker'
   Reason: User not found in LDAP directory
```

Et dans les logs VPN :
```
âŒ [WARNING] Connection attempt from 172.25.X.10 failed
   User: hacker (authentication failed)
```

:::tip[ğŸ›¡ï¸ SÃ©curitÃ© confirmÃ©e !]
Si la connexion Ã©choue avec un compte invalide, cela prouve que :
- âœ… L'authentification LDAP fonctionne
- âœ… Seuls les utilisateurs autorisÃ©s peuvent se connecter
- âœ… Les tentatives d'intrusion sont dÃ©tectÃ©es et loguÃ©es
- âœ… Le systÃ¨me de sÃ©curitÃ© est opÃ©rationnel
:::

:::tip[Validation Ã‰tape 5.9]
- âœ… La connexion avec "hacker" Ã©choue (comme prÃ©vu)
- âœ… Message d'erreur : "Authentication failed"
- âœ… Les logs montrent l'Ã©chec d'authentification
- âœ… Capture d'Ã©cran : Message d'erreur de connexion
- âœ… Capture d'Ã©cran : Log d'Ã©chec d'authentification sur le SNS
:::

---

## Ã‰tape 5.10 : DÃ©connexion propre et nettoyage

### ğŸ”§ TÃ¢che : Se dÃ©connecter du VPN

**1. ArrÃªter la session VPN**

```bash
openvpn3 session-manage --disconnect --config VPN-TechServices
```

**2. VÃ©rifier que l'interface tun0 a disparu**

```bash
ip a
# L'interface tun0 ne doit plus apparaÃ®tre
```

**3. VÃ©rifier que les routes VPN ont Ã©tÃ© supprimÃ©es**

```bash
ip route
# La route vers 10.Y.1.0/24 ne doit plus apparaÃ®tre
```

**4. Tenter d'accÃ©der au serveur Debian (doit Ã©chouer)**

```bash
ping -c 4 10.Y.1.20
# RÃ©sultat attendu : Ã‰chec (pas de route)
```

:::tip[Retour Ã  la normale]
AprÃ¨s dÃ©connexion :
- âŒ Plus d'accÃ¨s au rÃ©seau interne (10.Y.1.0/24)
- âŒ Plus d'interface tun0
- âœ… AccÃ¨s Internet normal (172.25.0.0/16)

Le comportement est revenu Ã  l'Ã©tat initial (avant Phase 5).
:::

---

## âœ… Tableau de validation de la Phase 5

ComplÃ©tez ce tableau dans votre compte-rendu :

| Test | Description | RÃ©sultat attendu | âœ…/âŒ |
|------|-------------|------------------|------|
| **Installation** | OpenVPN installÃ© | Version affichÃ©e | |
| **Profil tÃ©lÃ©chargÃ©** | Fichier .ovpn rÃ©cupÃ©rÃ© | Fichier prÃ©sent | |
| **Import profil** | Profil importÃ© dans OpenVPN3 | Configuration visible | |
| **Connexion jdupont** | Connexion VPN rÃ©ussie | Status: Connected | |
| **IP virtuelle** | IP attribuÃ©e (10.Y.100.x) | IP visible | |
| **Interface tun0** | Interface VPN crÃ©Ã©e | Interface prÃ©sente | |
| **Routes VPN** | Routes vers 10.Y.1.0/24 via tun0 | Routes correctes | |
| **Ping gateway VPN** | ping 10.Y.100.1 | OK | |
| **Ping SNS IN** | ping 10.Y.1.254 | OK | |
| **Ping serveur Debian** | ping 10.Y.1.20 | OK | |
| **AccÃ¨s web** | http://10.Y.1.20 | Page affichÃ©e | |
| **AccÃ¨s SSH** | ssh vers 10.Y.1.20 | Connexion OK | |
| **Transfert fichier** | SCP vers 10.Y.1.20 | Fichier transfÃ©rÃ© | |
| **Logs VPN** | Connexion visible dans logs | Ã‰vÃ©nements loggÃ©s | |
| **Connexion mmartin** | DeuxiÃ¨me utilisateur | Connexion OK | |
| **Connexion pdurand** | TroisiÃ¨me utilisateur | Connexion OK | |
| **SÃ©curitÃ©** | Utilisateur invalide bloquÃ© | Connexion refusÃ©e | |
| **DÃ©connexion** | VPN dÃ©connectÃ© proprement | Plus d'accÃ¨s interne | |

---

## âœ… CritÃ¨res de validation de la Phase 5

Avant de terminer l'activitÃ©, assurez-vous que :

- [ ] OpenVPN Connect est installÃ© sur la VM Client
- [ ] Le profil .ovpn a Ã©tÃ© tÃ©lÃ©chargÃ© depuis le portail
- [ ] Le profil est importÃ© dans OpenVPN3
- [ ] La connexion VPN avec jdupont rÃ©ussit
- [ ] Une IP virtuelle (10.Y.100.x) est attribuÃ©e
- [ ] L'interface tun0 est crÃ©Ã©e
- [ ] Les routes vers 10.Y.1.0/24 passent par le VPN
- [ ] Le ping vers 10.Y.1.20 (serveur Debian) fonctionne
- [ ] La page web du serveur Debian est accessible via le navigateur
- [ ] La connexion SSH au serveur Debian fonctionne
- [ ] Les logs VPN cÃ´tÃ© serveur montrent la connexion
- [ ] Les 3 utilisateurs (jdupont, mmartin, pdurand) peuvent se connecter
- [ ] Un utilisateur invalide ne peut pas se connecter
- [ ] AprÃ¨s dÃ©connexion, l'accÃ¨s au rÃ©seau interne n'est plus possible

:::tip[Checkpoint final enseignant]
ğŸ‘¨â€ğŸ« Faites valider l'ensemble de l'activitÃ© par l'enseignant.
Montrez-lui :
1. La connexion VPN active (openvpn3 sessions-list)
2. L'accÃ¨s au serveur web Debian via le navigateur
3. Une session SSH active sur le serveur Debian
4. Les logs VPN montrant plusieurs connexions
5. Le test de sÃ©curitÃ© (utilisateur invalide bloquÃ©)
:::

---

## ğŸ¯ RÃ©sumÃ© de la Phase 5

Vous avez maintenant :

- âœ… InstallÃ© et configurÃ© OpenVPN Connect
- âœ… RÃ©cupÃ©rÃ© et analysÃ© le profil de connexion
- âœ… Ã‰tabli un tunnel VPN SSL chiffrÃ©
- âœ… Obtenu une IP virtuelle sur le rÃ©seau distant
- âœ… AccÃ©dÃ© aux ressources internes (web, SSH, fichiers)
- âœ… VÃ©rifiÃ© le fonctionnement pour tous les utilisateurs
- âœ… ConfirmÃ© que la sÃ©curitÃ© fonctionne (utilisateurs non autorisÃ©s bloquÃ©s)
- âœ… AnalysÃ© les logs cÃ´tÃ© serveur

**ğŸŠ L'activitÃ© VPN SSL est terminÃ©e avec succÃ¨s ! ğŸŠ**

Vous avez mis en place une infrastructure VPN SSL complÃ¨te et fonctionnelle, permettant l'accÃ¨s distant sÃ©curisÃ© aux ressources d'entreprise.

**Prochaine Ã©tape** : RÃ©daction du compte-rendu final

---

## ğŸ“š Pour aller plus loin (bonus)

### Bonus 1 : Connexions simultanÃ©es

Testez avec 2 machines clientes diffÃ©rentes (binÃ´me) :
- Ã‰tudiant X : jdupont
- Ã‰tudiant Y : mmartin

Les deux peuvent-ils accÃ©der simultanÃ©ment au serveur Debian ?
Observer les IPs attribuÃ©es et les logs.

### Bonus 2 : Test de performance

Mesurez la bande passante via le VPN :
```bash
# Sur le serveur Debian
sudo apt install iperf3
iperf3 -s

# Sur le client VPN
iperf3 -c 10.Y.1.20 -t 10
```

Comparez avec la bande passante sans VPN.

### Bonus 3 : Activer la double authentification

Sur le SNS :
```
Configuration â†’ VPN â†’ VPN SSL â†’ Authentification
```

Activer :
- âœ… Certificat client + mot de passe

GÃ©nÃ©rer des certificats clients individuels et tester la connexion.

### Bonus 4 : Interface graphique OpenVPN

Installer une interface graphique pour gÃ©rer le VPN plus facilement :
```bash
sudo apt install network-manager-openvpn-gnome
```

Importer le profil via l'interface graphique XFCE.
